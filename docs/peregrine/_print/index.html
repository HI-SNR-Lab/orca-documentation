<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://orca.hisnr.com/docs/peregrine/><link rel=alternate type=application/rss+xml href=https://orca.hisnr.com/docs/peregrine/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=https://orca.hisnr.com/favicons/favicon.ico><link rel=apple-touch-icon href=https://orca.hisnr.com/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-192x192.png sizes=192x192><title>Peregrine UAV-Borne Radar | Open Radar Code Architecture</title>
<meta name=description content="Details about the Peregrine UAS"><meta property="og:url" content="https://orca.hisnr.com/docs/peregrine/"><meta property="og:site_name" content="Open Radar Code Architecture"><meta property="og:title" content="Peregrine UAV-Borne Radar"><meta property="og:description" content="Details about the Peregrine UAS"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Peregrine UAV-Borne Radar"><meta itemprop=description content="Details about the Peregrine UAS"><meta itemprop=dateModified content="2024-06-09T15:38:29-01:00"><meta itemprop=wordCount content="14"><meta name=twitter:card content="summary"><meta name=twitter:title content="Peregrine UAV-Borne Radar"><meta name=twitter:description content="Details about the Peregrine UAS"><link rel=preload href=https://orca.hisnr.com/scss/main.min.d180a40143076fc2b4d710452bc5b57c3b4fb1e656d592a0d78a47a66d00a5df.css as=style><link href=https://orca.hisnr.com/scss/main.min.d180a40143076fc2b4d710452bc5b57c3b4fb1e656d592a0d78a47a66d00a5df.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=https://orca.hisnr.com/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Open Radar Code Architecture</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/docs/radar/><i class='fa-solid fa-gears'></i><span>ORCA Software-Defined Radar Guide</span></a></li><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/docs/mapperr/><i class='fa-solid fa-map'></i><span>MAPPERR</span></a></li><li class=nav-item><a class="nav-link active" href=https://orca.hisnr.com/docs/peregrine/><i class='fa-solid fa-plane-departure'></i><span>Peregrine</span></a></li><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/about/><i class='fa-solid fa-people-group'></i><span>About</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=https://orca.hisnr.com/docs/peregrine/>Return to the regular view of this page</a>.</p></div><h1 class=title>Peregrine UAV-Borne Radar</h1><div class=lead>Details about the Peregrine UAS</div><ul><li>1: <a href=#pg-cf252ce1f79916435033b3619324bc8b>Peregrine Payload</a></li><ul><li>1.1: <a href=#pg-5c54d50aa1e0b71de4f09d9fc05813b2>Peregrine Radar Payload Box Assembly</a></li><ul></ul><li>1.2: <a href=#pg-7d2801d0e482f63a6a7d9bbfb01e045d>Raspberry Pi Setup</a></li><ul><li>1.2.1: <a href=#pg-261150229039da055a29b5b51b4e72e7>Connecting to the Raspberry Pi</a></li><li>1.2.2: <a href=#pg-9e1cddaa6d9341ed8eb6a9978b03ad7e>Debugging: Real-Time Clocks (RTC)</a></li><li>1.2.3: <a href=#pg-cbee3f51f0dda6860ef7e3ca0ee7785a>Customizing user-data</a></li><li>1.2.4: <a href=#pg-61db8ec95a554267e86e9456c1179522>Raspberry Pi Network Connection</a></li><ul></ul></ul><li>1.3: <a href=#pg-4c89c29d53af73eddf3d18c23c181774>Data Storage Options</a></li><li>1.4: <a href=#pg-7dcd91265f5b85793c574a265a4f3e68>External button</a></li><ul></ul></ul><li>2: <a href=#pg-5ff86ec97550a3558ce99a1679a497ab>5V Power Board and Power Harnesses</a></li><ul></ul><li>3: <a href=#pg-c753e93257e93b91e94aba20cb857012>Peregrine Radar Operating Instructions</a></li><ul><li>3.1: <a href=#pg-2d67bd174f92eee89f4c4bcb39fc874c>Logger Service Setup</a></li><ul></ul><li>3.2: <a href=#pg-4d3881fa475af65bab19cad623617626>Radar Service Setup</a></li><ul></ul></ul><li>4: <a href=#pg-88cc421379ba8b45e0513dd66c9c1425>UAV Setup</a></li><ul><li>4.1: <a href=#pg-dc56973d26ddd1ffb1dd1113ee13801d>UAV Power</a></li><ul></ul></ul><li>5: <a href=#pg-09d1c2e6fa237eb543abf8a55cc772dc>Other Resources</a></li><ul><li>5.1: <a href=#pg-aca7e25603b179d2271831f189bef5f0>Sourcing Custom Parts</a></li></ul></ul><div class=content><div class="pageinfo pageinfo-primary"><p>Peregrine is an ice-penetrating radar-equipped small UAS designed to be low-cost and field portable.</p></div></div></div><div class=td-content><h1 id=pg-cf252ce1f79916435033b3619324bc8b>1 - Peregrine Payload</h1><div class=lead>Details about the Peregrine Radar Payload</div><div class="pageinfo pageinfo-primary"><p>Peregrine is an ice-penetrating radar-equipped small UAS designed to be low-cost and field portable.</p></div></div><div class=td-content><h1 id=pg-5c54d50aa1e0b71de4f09d9fc05813b2>1.1 - Peregrine Radar Payload Box Assembly</h1><div class=lead>Build instructions for the core of the radar payload</div><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:689px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/peregrine-payload-box/payload-box-cad_hu_f2545c49d90b6935.png width=679 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Major components of the Peregrine radar payload box</p></p></figcaption></figure><h2 id=bill-of-materials>Bill of Materials</h2><p>A complete bill of materials for the payload box is available in <a href="https://docs.google.com/spreadsheets/d/1dFItvJ4mGw7Axdo4Iq9m_65ks9YspEahcemvucNRllk/edit?usp=sharing">this Google Sheet</a>, embedded below.</p><p>Some parts are custom made. See the <a href=https://orca.hisnr.com/docs/peregrine/resources/custom-parts/>Custom Parts</a> page for suggestions on how to build these yourself or source them from reliable vendors. Design files for these parts are available in the <a href=https://github.com/thomasteisberg/peregrine_hardware>Peregrine Hardware repository</a>.</p><script type=text/javascript>function resizeIframe(e){e.height=e.contentWindow.document.body.scrollHeight+"px"}</script><iframe id=iframe-id src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?gid=0&amp;amp;single=true&amp;amp;widget=true&amp;amp;headers=false" width=100% name=iframe-name style=min-height:40vh onload=resizeIframe(this) referrerpolicy=no-referrer><p>Your browser can not display embedded frames. You can access the embedded page via the following link: <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?gid=0&amp;amp;single=true&amp;amp;widget=true&amp;amp;headers=false">https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?gid=0&amp;amp;single=true&amp;amp;widget=true&amp;amp;headers=false</a></p></iframe><h2 id=assembly-instructions>Assembly instructions</h2><h3 id=preparing-enclosure-halves>Preparing enclosure halves</h3><p>The payload box is a clamshell-style design with two interlocking halves. The
&ldquo;upper&rdquo; half contains the SDR. The &ldquo;lower&rdquo; half holds the Raspberry Pi.
Sandwiched between the two halves is the &ldquo;payload divider&rdquo; PCB, which houses
some sensors and provides for external connections.</p><p>Starting with the Pi Shell:</p><ol><li>Place 4x M2.5 heat inserts into the four mounting holes at the bottom of the box.</li><li>Place 2x M2.5 heat inserts into the two front panel mounting holes on the
front of the box.</li></ol><p>Continuing with the SDR Shell:</p><ol start=3><li>Place 4x M2.5 heat inserts into the four holes in the tabs sticking up, to
accept bolts from the outside to connect the two shells together.</li></ol><h3 id=copper-foil-wrapping>Copper foil wrapping</h3><div class="alert alert-info" role=alert><h4 class=alert-heading>Why is the box wrapped in copper tape?</h4><p>The SDR and the Pi communicate over a USB 3 interface. Unfortunately, USB 3 has
known RF interference issues. The copper foil wrapping helps to minimize the
impact of the noisy USB 3 connection on other devices. We have particularly
had problems with GPS receivers (such as the one connected to the Peregrine
autopilot) not being able to get a fix without this copper wrapping.</p><p>You can read more about the USB 3 interference issues <a href=https://www.usb.org/sites/default/files/327216.pdf>from this Intel
appnote</a>.</p></div><p>Print out the <a href=https://github.com/thomasteisberg/peregrine_hardware/blob/main/payload_enclosure/fabrication_files_pi4/cutout_templates.pdf>cutout templates</a>. The PDF contains cutout templates for the copper foil wrapping on the top and bottom of the
enclosure.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Double check the dimensions</h4>Use a ruler to measure the marked dimensions on the first page to make sure your
print is at the right scale.</div><p>Spread a layer of adhesive-backed copper out on a cutting-safe surface
(such as a sacrificial piece of wood) and use some masking tape to hold it down.
Tape the cutout template on top. Use an X-Acto knife (or similar) to cut:</p><ol><li>A small &ldquo;X&rdquo; across each of the external bolt holes (to allow a bolt to go
through &ndash; no need to try to cut out the circle itself)</li><li>The internal cutout for the heatsink</li><li>The exterior outline of the entire piece.</li></ol><p>If you&rsquo;re not sure which lines to cut, take a moment to see how the paper folds
around the 3D printed pieces. Your goal is to fully cover the exterior.</p><p>Carefully peel away the adhesive from part of the copper foil and start pasting
it onto the 3D printed piece. It&rsquo;s easier to do this bit by bit, rather than
pulling the entire backing off at once.</p><p>Repeat with the other half of the enclosure.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7d2801d0e482f63a6a7d9bbfb01e045d>1.2 - Raspberry Pi Setup</h1><p>In order to standardize between units, much of the Pi setup is automated or
semi-automated. This guide will walk you through the steps of setting up
your Pi the way we do. Along the way, there are also links for more information
on how to customize this setup. This is an area where you will almost certainly
need to customize some aspects of the setup.</p><h2 id=initial-setup-with-cloud-init>Initial setup with cloud-init</h2><p>Setup of the Raspberry Pi is semi-automated using <a href=https://cloudinit.readthedocs.io/en/latest/>cloud-init</a>.</p><h3 id=cloud-init-customization>Cloud-init customization</h3><p>The cloud-init setup is controlled by two files: <code>user-data</code> and <code>network-config</code>.
(You&rsquo;ll use these files a couple of steps down.)</p><p>Examples of each are shown below, but you will likely need to modify these to suit
your purpose. We have pages on how to customize
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/user-data-config/>user-data</a> and
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>network-config</a>.</p><h4 id=user-data-example>user-data Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#cloud-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># This is the user-data configuration file for cloud-init.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># The cloud-init documentation has more details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>system_info</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>default_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Allow the default user to shutdown or reboot the system without entering a password (used by our automated scripts)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sudo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># On first boot, set the (default) ubuntu user&#39;s password to &#34;cryosphere&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>chpasswd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>expire</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$6$rounds=4096$aQ7tu0.beL3WAL32$fKxKYvZpY7EMCoxAU1heRomA3v8WvgbqBhhz08QwOtQdlP/DJOP2BThqZFoRW8d2a9PaIKK9BC9NHs1qNnkya1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hash</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Enable password authentication with the SSH daemon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ssh_pwauth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Set a default timezone</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>timezone</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Etc/UTC</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Update apt database and upgrade packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_update</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_upgrade</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Install additional packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>net-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>git</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>cmake</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>g++</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mosh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>exfat-fuse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2c-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>rpi.gpio-common</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>util-linux-extra</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Write arbitrary files to the file-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>write_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    exec &gt; &gt;(tee -a &#34;initial_setup_output.log&#34;) 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Miniconda Setup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    wget --progress=bar:force:noscroll &#34;https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh&#34; -O $HOME/miniconda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    bash $HOME/miniconda.sh -b -p $HOME/miniconda
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd $HOME
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source .profile
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source miniconda/etc/profile.d/conda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda init bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Setup logger environment
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:thomasteisberg/uav_radar_logger.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Clone uhd_radar repo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:radioglaciology/uhd_radar.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd uhd_radar
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #git checkout thomas/dask # Uncomment if you want to check out a specific branch other than main
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda env create -n uhd -f environment-rpi.yaml
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda activate uhd
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    python /home/ubuntu/miniconda/envs/uhd/lib/uhd/utils/uhd_images_downloader.py
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable radar.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable logger.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ifconfig
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    sudo reboot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.profile</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    PATH=/home/ubuntu/miniconda/bin:$PATH
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source /home/ubuntu/.bashrc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.ssh/known_hosts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk=</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/security/limits.conf</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Recommended by Ettus https://kb.ettus.com/USRP_Host_Performance_Tuning_Tips_and_Tricks</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ubuntu    - rtprio    99</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/radar.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to run the radar code on startup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uhd_radar/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uhd_radar/manager/radar_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=10
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/logger.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to log data from I2C sensors and automatically shutdown below a voltage threshold
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uav_radar_logger/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uav_radar_logger/logger_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=60
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Run arbitrary commands at rc.local like time</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># These commands are run with root permissions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># If you want commands run as a normal user, put them in initial_setup.sh (see above)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># which is run as the &#34;ubuntu&#34; user (see below)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>runcmd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown -R ubuntu:ubuntu /home/ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chmod +x /home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>wget -O /etc/udev/rules.d/uhd-usrp.rules https://raw.githubusercontent.com/EttusResearch/uhd/master/host/utils/uhd-usrp.rules</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G i2c ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G dialout ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G tty ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>apt remove -y modemmanager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>systemctl stop serial-getty@ttyS0.service &amp;&amp; systemctl disable serial-getty@ttyS0.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2cdetect -y 1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;dtoverlay=i2c-rtc,pcf8523&#34; &gt;&gt; /boot/firmware/config.txt</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>loginctl enable-linger ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mkdir /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chgrp ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;/dev/sda2  /media/ssd  exfat  defaults,nofail,uid=1000,gid=1000  0  2&#34; | tee -a /etc/fstab</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=network-config-example>network-config Example</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This file contains a netplan-compatible configuration which cloud-init will</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># apply on first-boot (note: it will *not* update the config after the first</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># boot). Please refer to the cloud-init documentation and the netplan reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># for full details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config-format-v2.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://netplan.io/reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ethernets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>eth0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Your ethernet name.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>192.168.11.137</span><span style=color:#000>/24]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>gateway4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>192.168.11.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nameservers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8.8.8.8</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>8.8.4.4</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>wifis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>renderer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>networkd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>wlan0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>optional</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>access-points</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI SSID HERE&gt;&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI PASSWORD HERE&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=imaging-your-pi>Imaging your Pi</h2><p>To start, download the Raspberry Pi Imager tool (or use your preferred software
for imaging SD cards). On Ubuntu, you can install it like this:</p><pre tabindex=0><code>sudo apt install rpi-imager
</code></pre><p>For other operating systems, see the <a href=https://www.raspberrypi.com/software/>website</a>.</p><div class="alert alert-info" role=alert><h4 class=alert-heading>Note on selecting a microSD card</h4><p>Not all (micro) SD cards are the same. Speed and reliability can both vary a lot.</p><p>Especially if you plan to store your data to your MicroSD card, you don&rsquo;t want to
mess around with this. Don&rsquo;t use an SD card that&rsquo;s off-brand, questionably sourced
(i.e. possibly counterfeit), or used.</p><p>We use Samsung Pro Plus series MicroSD cards. There are other storage options too.
See <a href=https://orca.hisnr.com/docs/peregrine/payload/data-storage/>Other Storage Options</a> for details.</p></div><p>Launch Imager. After clicking on &ldquo;Choose OS,&rdquo; navigate through the general purpose
category to find <code>Ubuntu Server 22.04.xx LTS 64-bit</code>. 64-bit is important &ndash; 32-bit
will not work.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:580px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-os_hu_a0ceabf4df131864.png width=570 height=115><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>You want Ubuntu Server 22.04 LTS 64-bit.</p></p></figcaption></figure><p>Insert your MicroSD card and select it as the location to write to.</p><p>After imaging is complete, you will see two drives mounted: <code>writable</code> and
<code>system-boot</code>.</p><h2 id=copying-cloud-init-config-files>Copying cloud-init config files</h2><p>After customizing the <code>user-data</code> and <code>network-config</code> files (see above),
copy <code>user-data</code> and <code>network-config</code> to the <code>system-boot</code> volume, replacing the
existing files.</p><p>Eject the microSD and put it back in the Pi.</p><h2 id=running-cloud-init>Running cloud-init</h2><div class="alert alert-info" role=alert><h4 class=alert-heading>Your Pi needs an internet connection for this part</h4>Make sure you Pi will have access to the internet before you begin this part.
See the <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>networking page</a> for information.</div><p>Power up the Pi and wait for cloud-init to run.</p><p>Within about a minute, your Pi should connect to whatever network interface(s)
are described in <code>network-config</code> and you should be able to find it on the
network. If you setup some sort of key-based authentication (such as by
importing a key from GitHub), it may take an extra couple of minutes for
this to be ready.</p><p>After the network setup is complete, you should be able to login over SSH.</p><p>For instructions on SSH-ing into your Pi, see <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/connect-to-pi/>here</a>.
In particular, please note that you need to have SSH agent forwarding working.
Instructions for this are on that page.</p><p>When you first login, cloud-init may not have finished running. To check the status, run:</p><pre tabindex=0><code>cloud-init status --long
</code></pre><p>There are also logs in <code>/var/log/cloud-init-output.log</code>.</p><p>To keep an eye on the entire process, you can run:</p><pre tabindex=0><code>watch &#34;cloud-init status --long &amp;&amp; tail -n 10 /var/log/cloud-init-output.log&#34;
</code></pre><p>Expect this process to take a few minutes to complete.</p><h2 id=running-initial_setupsh>Running initial_setup.sh</h2><p>After the cloud-init process is complete, you&rsquo;ll also need to run
<code>initial_setup.sh</code>:</p><p><code>./initial_setup.sh</code></p><p>This will log to <code>/home/ubuntu/initial_setup_output.log</code>. It may take around 10
minutes to complete. It will automatically reboot your Pi at the end. If you
don&rsquo;t want this, feel free to comment out the last line.</p><h2 id=setting-up-the-logger-service>Setting up the logger service</h2><p>More details on the logging service will eventually be <a href=https://orca.hisnr.com/docs/peregrine/operating/logger-service/>here</a>.</p><p>For now, if you&rsquo;re building a Peregrine system, the default setup should be fine.</p><p>If you&rsquo;re building Eyas, first run this command to create a place for logs:</p><pre tabindex=0><code>mkdir /media/ssd/logger
</code></pre><p>And then modify the last line of <code>/home/ubuntu/uav_radar_logger/logger_service.sh</code>
to look like this:</p><pre tabindex=0><code>python -u logger.py --shutdown-voltage 11.8 --log-dir /media/ssd/logger/
</code></pre><p>Replacing <code>11.8</code> with an appropriate threshold (in volts) at which to shutdown.</p><h2 id=setting-up-the-radar-service>Setting up the radar service</h2><p>More details on the radar service will eventually be <a href=https://orca.hisnr.com/docs/peregrine/operating/radar-service/>here</a>.</p><p>For now, if you&rsquo;re building a Peregrine system, the default setup should be fine.</p><p>If you&rsquo;re building Eyas, run these commands to create a location for logging data
and update the default configuration:</p><pre tabindex=0><code>mkdir /media/ssd/radar
cd /home/ubuntu/uhd_radar/config
mv default.yaml default-old.yaml
cp default-eyas.yaml default.yaml
</code></pre><h2 id=using-overlayroot-to-protect-the-file-system>Using overlayroot to protect the file system</h2><p>Let&rsquo;s take a quick step back and talk about the problem before we talk about
(perhaps drastic) solutions:</p><p><a href=https://hackaday.com/2022/03/09/raspberry-pi-and-the-story-of-sd-card-corruption/>MicroSD card corruption</a>
is an ongoing challenge for any device (such as the Pi) that boots from a
MicroSD card. Most cases can be traced to either (a) junk MicroSD cards or
(b) sudden power loss during a write operation.</p><p>You can mostly avoid problem (a) by carefully sourcing your MicroSD cards. If
you&rsquo;re considering saving $20 by buying an off-brand MicroSD card or, worse,
a possible fake, don&rsquo;t do it.</p><p>Sudden power loss is harder to completely guard against. Ideally, you want to
shutdown your Pi before removing power. This can be done by SSH-ing into it and
running <code>sudo shutdown -h now</code> and waiting about a minute. If you use our
radar systemd service, you can also perform a safe shutdown by pressing and
holding the button for 5 seconds, waiting for the light to turn off, and then
giving it about a minute to fully shut down.</p><p>For Peregrine, this should all be good enough.</p><p>For Eyas and other longer-term installations, the risk of a battery discharging
faster than expected is relatively high.</p><p>The first line of defense is the automatic shutdown provided by the logger
service that will safely shut everything down when the battery voltage gets too
low.</p><p>If you have a separate data storage device, such as an external USB-connected SSD,
you can go a step further and make your Pi&rsquo;s MicroSD card read-only.</p><p>A utility called <code>overlayroot</code> (which uses <a href=https://docs.kernel.org/filesystems/overlayfs.html>OverlayFS</a>)
can be used to make the root filesystem read-only and create an &ldquo;overlay filesystem&rdquo;
stored only in RAM. This means that all changes to the MicroSD card file system
are temporary and are lost upon reboot.</p><p>This is great for keeping a standardized configuration, but you need to be aware
that this means most log files are lost on reboot, any config files on the SD
card are lost on reboot, and all radar data you want to keep around must be stored
to your external storage device.</p><p>You can read
<a href=https://rex.writeas.com/use-overlay-filesystem-on-ubuntu>a more detailed tutorial about Overlayroot here</a>.</p><p><strong>If you&rsquo;re going to do this, be sure that you&rsquo;ve tested your setup in advance
so you know if the data you want to keep is being stored.</strong></p><h3 id=enabling-overlayroot>Enabling Overlayroot</h3><p>If you still want to set this up, it&rsquo;s quite easy to enable.</p><p>Simply edit the last line of <code>/etc/overlayroot.conf</code> to this:</p><pre tabindex=0><code>overlayroot=&#34;tmpfs:recurse=0&#34;
</code></pre><p><code>tmpfs</code> specifies that we want to use a RAM-based filesystem to store the &ldquo;overlay&rdquo;
part of the filesystem. <code>recurse=0</code> says that we want to apply this only to the
<code>/</code> mount and not to other mounts below that.</p><p>(You need to edit this file as root. For example: <code>sudo vim /etc/overlayroot.conf</code>)</p><h3 id=disabling-overlayroot>Disabling Overlayroot</h3><p>You can temporarily re-mount the root filesystem to edit things using the
built-in utility:</p><pre tabindex=0><code>sudo overlayroot-chroot
</code></pre><p>To exit, just type <code>exit</code>.</p><p>If you want to permenantly disable it, just edit the last line of <code>/etc/overlayroot.conf</code>
back to:</p><pre tabindex=0><code>overlayroot=&#34;&#34;
</code></pre><p>and reboot.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-261150229039da055a29b5b51b4e72e7>1.2.1 - Connecting to the Raspberry Pi</h1><p>By default, the cloud-init script sets up a static IP of <code>192.168.11.137</code>, but
you could choose to configure this to something different for each payload box.</p><p>Our usual way of connecting is by plugging an ethernet cable into the Pi and
connecting it to a laptop. You can read about
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>all the networking options here</a>.</p><h2 id=ssh-agent-forwarding>SSH agent forwarding</h2><p>If you need to authenticate to GitHub to download code, the recommended way is
using <a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/using-ssh-agent-forwarding>SSH agent forwarding</a>.</p><p>To summarize the above link, you should make sure you have
<a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/checking-for-existing-ssh-keys>an SSH key setup with your GitHub account</a>.</p><p>Test this by running <code>ssh -T git@github.com</code>.</p><p>Then modify your <code>~/.ssh/config</code> file to have an entry like this enabling
SSH agent forwarding:</p><pre tabindex=0><code>Host 192.168.11.137
    HostName 192.168.11.137
    User ubuntu
    ForwardAgent yes
</code></pre><h2 id=sshing-to-your-pi>SSH&rsquo;ing to your Pi</h2><p>Connect to the Raspberry Pi over SSH:</p><pre tabindex=0><code>ssh ubuntu@192.168.11.137
</code></pre><div class="alert alert-info" role=alert><h4 class=alert-heading>Remote host identification has changed</h4><p>If you use the same static IP for multiple Pi&rsquo;s (which, presumably, you only
ever use one of at a time), you may encounter an error stating:</p><pre tabindex=0><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
</code></pre><p>This is because your computer thinks its connecting to a different Raspberry Pi.</p><p>You can manually add the fingerprint for the currently connected Pi like this:</p><pre tabindex=0><code>ssh-keyscan -H 192.168.11.137 &gt;&gt; ~/.ssh/known_hosts
</code></pre><p>(This would be a bad idea to do at random for a remote computer. I&rsquo;m assuming
here that you&rsquo;ve just plugged in a new Pi right in front of you and you
know exactly why you&rsquo;re getting this error. You should only have to do this once
per new Pi.)</p></div><p>You can test that your SSH agent forwarding is working by running
<code>ssh -T git@github.com</code> again while SSH&rsquo;d into your Pi.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9e1cddaa6d9341ed8eb6a9978b03ad7e>1.2.2 - Debugging: Real-Time Clocks (RTC)</h1><div class=lead>RTC choices and possible solutions to RTC issues</div><p>A real-time clock (RTC) is a small device equipped with a crystal oscillator and
a battery that is responsible for keeping track of the current time, even while
your computer (or Raspberry Pi) is powered off.</p><p>The &ldquo;Payload Enclosure Divider&rdquo; includes a <a href=https://www.nxp.com/docs/en/data-sheet/PCF8523.pdf>PCF8523</a>
RTC and a holder for a CR1220 coin cell battery. The provided <code>user-config</code> file
should automatically set this up. As long as you provide internet access to
the Pi once, it will automatically synchronize the RTC with a network time server
and everything will just work.</p><h3 id=tell-me-more-about-the-pcf8523-and-how-to-use-it>Tell me more about the PCF8523 and how to use it</h3><p>Adafruit makes a great breakout for the same chip <a href=https://www.adafruit.com/product/5189>available here</a>.</p><p>They also have a great <a href="https://learn.adafruit.com/adding-a-real-time-clock-to-raspberry-pi?view=all">tutorial on setting up various RTCs with the Pi</a>.</p><h3 id=my-pi-5-already-has-an-rtc-built-in-right>My Pi 5 already has an RTC built-in, right?</h3><p>Yes, there is. <a href=https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#real-time-clock-rtc>Documentation for the built-in RTC is here.</a></p><p>The built-in RTC still requires adding a <em>rechargable</em> lithium manganese battery
to the Pi&rsquo;s J5 connector. Charging of this battery is disabled by default and
must be manually enabled.</p><p>In theory, you should be able to add the official Pi RTC battery, follow the
official instructions to enable charging, and everything should work.</p><h3 id=i-have-a-pi-5-but-still-want-to-use>I have a Pi 5 but still want to use</h3></div><div class=td-content style=page-break-before:always><h1 id=pg-cbee3f51f0dda6860ef7e3ca0ee7785a>1.2.3 - Customizing user-data</h1><p>The default user-data we start from is as shown below. You will likely need to
tweak many of these settings. Descriptions and tips for the most important
sections are below.</p><p>Note that this is one of two key configuration files. You can read about
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>network-config here</a>.</p><h2 id=starting-point-user-data-file>Starting point user-data file</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#cloud-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># This is the user-data configuration file for cloud-init.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># The cloud-init documentation has more details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>system_info</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>default_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Allow the default user to shutdown or reboot the system without entering a password (used by our automated scripts)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sudo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># On first boot, set the (default) ubuntu user&#39;s password to &#34;cryosphere&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>chpasswd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>expire</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$6$rounds=4096$aQ7tu0.beL3WAL32$fKxKYvZpY7EMCoxAU1heRomA3v8WvgbqBhhz08QwOtQdlP/DJOP2BThqZFoRW8d2a9PaIKK9BC9NHs1qNnkya1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hash</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Enable password authentication with the SSH daemon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ssh_pwauth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Set a default timezone</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>timezone</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Etc/UTC</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Update apt database and upgrade packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_update</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_upgrade</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Install additional packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>net-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>git</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>cmake</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>g++</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mosh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>exfat-fuse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2c-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>rpi.gpio-common</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>util-linux-extra</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Write arbitrary files to the file-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>write_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    exec &gt; &gt;(tee -a &#34;initial_setup_output.log&#34;) 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Miniconda Setup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    wget --progress=bar:force:noscroll &#34;https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh&#34; -O $HOME/miniconda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    bash $HOME/miniconda.sh -b -p $HOME/miniconda
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd $HOME
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source .profile
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source miniconda/etc/profile.d/conda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda init bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Setup logger environment
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:thomasteisberg/uav_radar_logger.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Clone uhd_radar repo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:radioglaciology/uhd_radar.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd uhd_radar
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #git checkout thomas/dask # Uncomment if you want to check out a specific branch other than main
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda env create -n uhd -f environment-rpi.yaml
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda activate uhd
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    python /home/ubuntu/miniconda/envs/uhd/lib/uhd/utils/uhd_images_downloader.py
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable radar.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable logger.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ifconfig
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    sudo reboot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.profile</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    PATH=/home/ubuntu/miniconda/bin:$PATH
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source /home/ubuntu/.bashrc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.ssh/known_hosts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk=</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/security/limits.conf</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Recommended by Ettus https://kb.ettus.com/USRP_Host_Performance_Tuning_Tips_and_Tricks</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ubuntu    - rtprio    99</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/radar.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to run the radar code on startup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uhd_radar/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uhd_radar/manager/radar_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=10
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/logger.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to log data from I2C sensors and automatically shutdown below a voltage threshold
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uav_radar_logger/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uav_radar_logger/logger_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=60
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Run arbitrary commands at rc.local like time</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># These commands are run with root permissions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># If you want commands run as a normal user, put them in initial_setup.sh (see above)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># which is run as the &#34;ubuntu&#34; user (see below)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>runcmd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown -R ubuntu:ubuntu /home/ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chmod +x /home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>wget -O /etc/udev/rules.d/uhd-usrp.rules https://raw.githubusercontent.com/EttusResearch/uhd/master/host/utils/uhd-usrp.rules</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G i2c ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G dialout ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G tty ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>apt remove -y modemmanager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>systemctl stop serial-getty@ttyS0.service &amp;&amp; systemctl disable serial-getty@ttyS0.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2cdetect -y 1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;dtoverlay=i2c-rtc,pcf8523&#34; &gt;&gt; /boot/firmware/config.txt</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>loginctl enable-linger ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mkdir /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chgrp ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;/dev/sda2  /media/ssd  exfat  defaults,nofail,uid=1000,gid=1000  0  2&#34; | tee -a /etc/fstab</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=password-less-shutdown>Password-less shutdown</h2><pre tabindex=0><code>system_info:
  default_user:
    name: ubuntu # Allow the default user to shutdown or reboot the system without entering a password (used by our automated scripts)
    sudo: &#34;ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown&#34;
</code></pre><p>One of the features supported by the uav_radar_logger utility is to automatically
cleanly shutdown the system if the measured battery voltage drops below a
threshold. To facilitate this, the default user must be able to shutdown the
system without needing additional authentication. This gives permission for the
<code>ubuntu</code> user to call <code>sudo shutdown</code> or <code>sudo reboot</code> without entering a password.</p><h2 id=password-authentication>Password authentication</h2><pre tabindex=0><code># On first boot, set the (default) ubuntu user&#39;s password to &#34;cryosphere&#34;
chpasswd:
  expire: false
  list:
  - ubuntu:$6$rounds=4096$aQ7tu0.beL3WAL32$fKxKYvZpY7EMCoxAU1heRomA3v8WvgbqBhhz08QwOtQdlP/DJOP2BThqZFoRW8d2a9PaIKK9BC9NHs1qNnkya1

# Enable password authentication with the SSH daemon
ssh_pwauth: true
</code></pre><p>This sets up a default password for the <code>ubuntu</code> user. You should change this to
something else (or disable password authentication completely, if you prefer).</p><p>Passwords are stored in a hashed format. You can generate password hashes using
this utility:</p><pre tabindex=0><code>mkpasswd --method=SHA-512 --rounds=4096
</code></pre><h2 id=timezone>Timezone</h2><pre tabindex=0><code># Set a default timezone
timezone: Etc/UTC
</code></pre><p>You could set this to other time zones (i.e. `America/Los_Angeles"), but really
it would make everyone&rsquo;s life easier if you just set your clock to UTC.</p><h2 id=add-ssh-keys-through-github>Add SSH keys through GitHub</h2><pre tabindex=0><code>## On first boot, use ssh-import-id to give the specific users SSH access to
## the default user
ssh_import_id:
- gh:thomasteisberg
- gh:albroome
- gh:dfxmay
</code></pre><p>You can very conveniently enable key-based authentication for specific GitHub
user names. If your username is in here and you have a public key setup with GitHub,
this public key will be imported and you will be able to SSH into your Pi
with no additional setup. You might want to remove us from your list, though. :)</p><h2 id=files>Files</h2><p>Arbitrary files can be written to the system with cloud-init. Some of these are
important.</p><h3 id=initial_setupsh>initial_setup.sh</h3><pre tabindex=0><code>- path: /home/ubuntu/initial_setup.sh
  content: |
    #!/bin/bash
    exec &gt; &gt;(tee -a &#34;initial_setup_output.log&#34;) 2&gt;&amp;1
    # Miniconda Setup
    wget --progress=bar:force:noscroll &#34;https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh&#34; -O $HOME/miniconda.sh
    bash $HOME/miniconda.sh -b -p $HOME/miniconda
    cd $HOME
    source .profile
    source miniconda/etc/profile.d/conda.sh
    conda init bash
    # Setup logger environment
    git clone git@github.com:thomasteisberg/uav_radar_logger.git
    # Clone uhd_radar repo
    git clone git@github.com:radioglaciology/uhd_radar.git
    cd uhd_radar
    #git checkout thomas/dask # Uncomment if you want to check out a specific branch other than main
    conda env create -n uhd -f environment.yaml
    conda activate uhd
    python /home/ubuntu/miniconda/envs/uhd/lib/uhd/utils/uhd_images_downloader.py
    systemctl --user enable radar.service
    systemctl --user enable logger.service
    ifconfig
    sudo reboot
  append: true
</code></pre><p>The <code>initial_setup.sh</code> script grabs copies of our code and sets up the radar and
logging services. This script is intended to be manually run the first time you
SSH into the system. This enables you to use
<a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/using-ssh-agent-forwarding>SSH agent forwarding</a>
to provide any needed GitHub authentication to get the code.</p><p>This is also where you would customize the repositories to check out (if, for
example, you&rsquo;ve forked our code) and where you can pick a branch to automatically
checkout.</p><h3 id=radar-and-logger-services>Radar and Logger services</h3><pre tabindex=0><code>- path: /etc/systemd/user/radar.service
  content: |
    [Unit]
    Description=Service to run the radar code on startup

    [Service]
    Type=simple
    WorkingDirectory=/home/ubuntu/uhd_radar/
    ExecStart=/home/ubuntu/uhd_radar/manager/radar_service.sh

    Restart=always
    RestartSec=10

    KillSignal=SIGINT

    [Install]
    WantedBy=default.target
- path: /etc/systemd/user/logger.service
  content: |
    [Unit]
    Description=Service to log data from I2C sensors and automatically shutdown below a voltage threshold

    [Service]
    Type=simple
    WorkingDirectory=/home/ubuntu/uav_radar_logger/
    ExecStart=/home/ubuntu/uav_radar_logger/logger_service.sh

    Restart=always
    RestartSec=60

    KillSignal=SIGINT

    [Install]
    WantedBy=default.target
</code></pre><p>Two systemd services are used to manage everything. One run the radar code in
its default button-controlled setup. The other runs basic logging of I2C-connected
sensors and handles automatic low-battery shutdown.</p><h2 id=run-commands>Run commands</h2><pre tabindex=0><code>runcmd:
- chown -R ubuntu:ubuntu /home/ubuntu
- chmod +x /home/ubuntu/initial_setup.sh
- wget -O /etc/udev/rules.d/uhd-usrp.rules https://raw.githubusercontent.com/EttusResearch/uhd/master/host/utils/uhd-usrp.rules
- usermod -a -G i2c ubuntu
- usermod -a -G dialout ubuntu
- usermod -a -G tty ubuntu
- apt remove -y modemmanager
- systemctl stop serial-getty@ttyS0.service &amp;&amp; systemctl disable serial-getty@ttyS0.service
- i2cdetect -y 1
- echo &#34;dtoverlay=i2c-rtc,pcf8523&#34; &gt;&gt; /boot/firmware/config.txt
- loginctl enable-linger ubuntu
- mkdir /media/ssd
- echo &#34;/dev/sda2  /media/ssd  exfat  defaults,nofail,uid=1000,gid=1000  0  2&#34; | tee -a /etc/fstab
</code></pre><p>Some final setup is done by running arbitrary commands. These are run as the root
user.</p><p>One aspect of this you may wish to customize are the last two lines, which add
settings to automatically mount an ExFAT-formatted SSD plugged into the Pi. This
can be (optionally) used as a storage location for radar data.</p><h2 id=testing-changes>Testing changes</h2><p>You may want to test your changes before using them on your Pi. Options for doing
that are <a href=https://cloudinit.readthedocs.io/en/latest/howto/predeploy_testing.html>described here</a>.
Note that the <code>initial_setup.sh</code> script downloads miniconda for the <code>aarch64</code>
architecture, which probably won&rsquo;t work on your computer. If you want to test that
part, you&rsquo;ll need to change this.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-61db8ec95a554267e86e9456c1179522>1.2.4 - Raspberry Pi Network Connection</h1><p>Most of the time, the Pi doesn&rsquo;t need an internet connection. There are, however,
a couple of cases where you may want some sort of a network connection to the Pi.</p><p>These are:</p><ol><li>Downloading data from the Pi to a computer (requires a network connection but not internet)</li><li>Initial setup with cloud-init (requires internet)</li><li>Updating code by pulling from GitHub (requires internet)</li></ol><h2 id=setting-up-network-interfaces>Setting up network interfaces</h2><h3 id=with-cloud-init-first-time-setup>With cloud-init (first-time setup)</h3><p>The preferred way to setup network interfaces is by providing them in the
<code>network-config</code> file read by <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/>cloud-init when first setting up the Pi</a>.</p><p>An example is shown below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This file contains a netplan-compatible configuration which cloud-init will</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># apply on first-boot (note: it will *not* update the config after the first</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># boot). Please refer to the cloud-init documentation and the netplan reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># for full details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config-format-v2.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://netplan.io/reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ethernets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>eth0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Your ethernet name.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>192.168.11.137</span><span style=color:#000>/24]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>gateway4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>192.168.11.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nameservers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8.8.8.8</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>8.8.4.4</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>wifis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>renderer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>networkd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>wlan0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>optional</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>access-points</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI SSID HERE&gt;&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI PASSWORD HERE&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The above configuration sets up a static IP over the ethernet interface. It
also configures <code>192.168.11.1</code> as the default gateway. This allows for sharing
an internet connection from a computer over this interface if desired.</p><p>The configuration also provides an SSID and password for a WiFi network. In practice,
we configure this to the settings for a phone hotspot that can be used to get
internet when WiFi is not otherwise available. This is also a simpler setup for
getting the Pi on the internet when needed.</p><h3 id=reconfiguring-with-netplan>Reconfiguring with netplan</h3><p>By default, network interfaces are configured with netplan. See
<a href=https://netplan.readthedocs.io/en/stable/examples/>the netplan documentation</a>
for more details.</p><h2 id=configuring-your-computer>Configuring your computer</h2><p>If you&rsquo;re connecting to the Pi via a simple ethernet cable to your computer,
you&rsquo;ll want both configured with static IPs. The config file above will do this
on the Pi side. On your computer, you&rsquo;ll want to set a static IP of <code>192.168.11.1</code>
and a netmask of <code>255.255.255.0</code>. For example, your settings may look like this:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:578px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/network-settings_hu_3b4ce8326a53a20e.png width=568 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Example laptop configuration to connect to the Pi over an ethernet cable</p></p></figcaption></figure><h3 id=sharing-internet-from-your-computer>Sharing internet from your computer</h3><div class="alert alert-info" role=alert><h4 class=alert-heading>Do you need to do this?</h4><p>This process is a little annoying to setup. If you can easily connect your Pi
to a separate WiFi network with internet access, you probably don&rsquo;t need to do this.</p><p>If your WiFi network requires complicated configuration to join, requires a key
or password you don&rsquo;t want to leave around on the Pi, or only allows some devices
to join, this is an alternative approach that only requires a separate computer
(i.e. your laptop) to have internet access.</p></div><p>Sharing your computer&rsquo;s internet connection from one network interface to another
is a useful trick to get an internet connection for the Pi. This can be done
between any two network interfaces (i.e. from your WiFi connection to the Pi over
ethernet or from one WiFi card to a network created by a second WiFi card).</p><p>The Arch Linux wiki has useful instructions for configuring
<a href=https://wiki.archlinux.org/title/Internet_sharing>internet sharing on Linux</a>.</p><p>To briefly summarize them:</p><p>All of this setup will happen on your laptop (or whatever computer has an
internet connection).</p><ol><li>Enable IPv4 forwarding: <code>sudo sysctl net.ipv4.ip_forward=1</code></li><li>Setup NAT with iptables: (See note below if you have docker installed!)</li></ol><pre tabindex=0><code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
sudo iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i net0 -o wlan0 -j ACCEPT
</code></pre><p>Where <code>wlan0</code> should be replaced with the name of the network interface on
your computer which is currently connected to the internet, and <code>net0</code> should
be replaced with the name of the network interface on the same computer which is
connected to the Pi.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Note for Docker users</h4><p>If you have docker installed on your system, it
<a href=https://docs.docker.com/network/packet-filtering-firewalls/>changes your default firewall settings</a>
. As a result, you need to setup NAT slightly differently:</p><pre tabindex=0><code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
sudo iptables -I DOCKER-USER 1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -I DOCKER-USER 2 -i net0 -o wlan0 -j ACCEPT
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4c89c29d53af73eddf3d18c23c181774>1.3 - Data Storage Options</h1><div class=lead>Options for how to store your radar data as its being recorded</div><p>There are three tested options for how to store your radar data, with various tradeoffs:</p><ol><li>MicroSD card &ndash; This is the <em>default</em> option that is assumed in the documentation.</li><li>External USB SSD or Flash Drive</li><li>NVMe SSD connected over PCIe interface (Pi 5 only)</li></ol><h3 id=microsd-card>MicroSD card</h3><p>This is the easiest option since it&rsquo;s built-in to the Raspberry Pi and requires no additional space or equipment.</p><p>MicroSD card quality varies significantly and counterfits are an issue. For this reason, purchasing from a reputable vendor is highly recommended.</p><p>We use <a href=https://www.samsung.com/us/computing/memory-storage/memory-cards/pro-plus-adapter-microsdxc-512gb-mb-md512sa-am/>Samsung Pro Plus MicroSDXC cards</a>, usually in 512 GB capacity.</p><p>You can find lots of online benchmarks of various MicroSD cards, such as <a href=https://www.jeffgeerling.com/blog/2019/raspberry-pi-microsd-card-performance-comparison-2019>this one</a> and <a href=https://www.pidramble.com/wiki/benchmarks/microsd-cards>this one</a>.</p><p>There are two downsides to this approach:</p><ol><li>Above 1 TB, MicroSD cards start to get quite expensive.</li><li>If you&rsquo;re storing data on the MicroSD card, it&rsquo;s not possible to use <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/#using-overlayroot-to-protect-the-file-system><code>overlayroot</code> to protect</a> the file system from corruption.</li></ol><h3 id=external-usb-drives>External USB drives</h3><p>External USB 3 SSDs or flash drives may be plugged into the USB 3.0 ports on the Pi and used as storage devices. We have used Samsung T7 Shield SSDs successfully in field deployments. The major advantage of this approach is that it is easy to swap out storage devices.</p><h3 id=nvme-ssd>NVMe SSD</h3><p>Starting with the Pi 5, a PCIe port is exposed allowing for NVMe devices including SSDs to be added. We have succesfully used the <a href="https://shop.pimoroni.com/products/nvme-base?variant=41219587178579">Pimoroni NVMe Base</a>.</p><p>This is the highest speed and most reliable storage option. The configuration we&rsquo;ve tested so far has kept the OS and radar code on the MicroSD card and used the SSD only for storage. It is, however, possible to <a href=https://www.jeffgeerling.com/blog/2023/nvme-ssd-boot-raspberry-pi-5>boot directly</a> from an NVMe SSD, though this configuration has not been tested with ORCA.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7dcd91265f5b85793c574a265a4f3e68>1.4 - External button</h1><p>An external lighted push button can be added to turn the radar on and off. A
connector for this is included on the Payload Divider PCB.</p><h2 id=button-choices>Button choices</h2><p>The intended button for the UAV version is <a href=https://www.digikey.com/en/products/detail/nkk-switches/HB15CKW01-5C-CB/1056598>HB15CKW01-5C-CB</a>.</p><p>Most other similar buttons can be used. For the ground-based version, we use <a href=https://www.digikey.com/en/products/detail/e-switch/ULV4F2BSS311/5299297>ULV4F2BSS311</a>.
Some of the photos on this page are taken with this button, which can be mounted externally.</p><h2 id=wiring-the-button>Wiring the button</h2><p>The button connector is a 5 position JST GH connector. The
<a href=https://www.digikey.com/en/products/detail/jst-sales-america-inc/GHR-05V-S/807817>connectors</a>
and
<a href=https://www.digikey.com/en/products/detail/jst-sales-america-inc/AGHGH28K102/10108415>pre-crimped wires</a>
are available separately or you can
<a href=https://www.amazon.com/Pre-Crimped-Connectors-Pixhawk2-Pixracer-Silicone/dp/B07PBHN7TM/>buy a kit</a>.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:783px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/button/button-wiring_hu_46d48fbc4d1e211f.png width=773 height=384><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Schematic section for the button connector. Right side shows recommended connections to the lighted button.</p></p></figcaption></figure><p>If you buy pre-crimped wires, you&rsquo;ll need to cut the connector on one side off.</p><p>For JST connectors, the small notch on the contact aligns with the bottom side of the connector.
On the bottom of the connector housing, there are a series of small plastic pins that will
raise up as you insert the contact. Once you get the contact fully inserted, this pin will fall back down
to lay flush.</p><p>To assemble the button:</p><ol><li>Cut pre-crimped JST wires to length</li><li>Following the image above, strip and solder the free end of each wire to the
specified terminals on the switch.</li><li>Place a piece of heatshrink over each terminal and shrink.</li><li>(Optional) Twist the wires gently and use small pieces of heat shrink to
keep them in a neat bundle.</li><li>Insert the contacts into the JST GH 5 position housing, following the diagram
above.</li><li>Mount the button and insert the connector into the plug on the payload divider PCB.</li></ol><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:645px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/button/button-components-eyas_hu_2680371be372f5dd.jpg width=635 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Components of the button assembly. Note that these pictures were taken with the
alternative version of the button designed to be mounted on the outside of a
Pelican case.</p></p></figcaption></figure><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:605px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/button/button-soldering-eyas_hu_ed7da4a496ead522.jpg width=595 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Cables soldered to the terminals of the button</p></p></figcaption></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-5ff86ec97550a3558ce99a1679a497ab>2 - 5V Power Board and Power Harnesses</h1><div class=lead>Build instructions for 5V power system</div><h2 id=5v-power-harness>5V Power Harness</h2><p>All lengths are tip to tip (including any connectors)</p><h3 id=connector-side-1-female-m8-connector-mcmaster-part-8605n11>Connector side 1: Female M8 connector (McMaster Part #8605N11)</h3><p>M8 pinout:</p><ul><li>Brown wire: 5V</li><li>Blue wire: GND</li></ul><p>Cut brown wire ~0.5 cm shorter than blue</p><h3 id=connector-side-2-molex-micro-fit-30-3-pos-connector-molex-part-0436450300>Connector side 2: Molex Micro-Fit 3.0 3 Pos connector (Molex Part #0436450300)</h3><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:810px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/power/microfit5v_hu_e70bacdbf5eacf29.jpg width=800 height=363><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Molex Micro-Fit 3 Position (5V Power) pinout &ndash; note location of the line indicating pin 1</p></p></figcaption></figure><p>Molex Micro-Fit pinout:</p><ul><li>Pin 1: unused</li><li>Pin 2: GND (black)</li><li>Pin 3: 5V (red)</li></ul><p>Use 22 AWG female terminals</p><p>Pre-crimped wires are available. Molex part is 2147611201 (black) and 2147612201 (red)</p><p>Cut black ~0.5 cm shorter than red</p><h3 id=assembly-instructions>Assembly instructions</h3><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:589px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/power/payload-power-components_hu_29fa22808ef6c1d4.jpg width=579 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Components of 5V power harness</p></p></figcaption></figure><ol><li>Cut all wires as shown in the photo above</li><li>Solder M8 brown wire to red Micro-Fit</li><li>Solder M8 blue wire to black Micro-Fit</li><li>Heat shrink each individual connection</li><li>Place larger (glue lined, if available) heat shrink over both connections and extending onto the yellow sheath of the M8 cable</li><li>Insert female MicroFit terminals into 3 position connector</li></ol><p>Result should look like below:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:810px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/power/5vpowerwithconnectors_hu_36d85b1aca95bc54.jpg width=800 height=294><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Completed 5V power harness (on left) connected to 5V power board</p></p></figcaption></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-c753e93257e93b91e94aba20cb857012>3 - Peregrine Radar Operating Instructions</h1><div class=lead>Details about the Peregrine UAS</div><div class="pageinfo pageinfo-primary"><p>Operating instructions for the Peregrine radar system</p></div></div><div class=td-content><h1 id=pg-2d67bd174f92eee89f4c4bcb39fc874c>3.1 - Logger Service Setup</h1><p>TODO</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4d3881fa475af65bab19cad623617626>3.2 - Radar Service Setup</h1><p>TODO</p><p><a href=https://github.com/mmaz/systemd-conda>Useful reference for conda environments with services</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-88cc421379ba8b45e0513dd66c9c1425>4 - UAV Setup</h1><div class=lead>Instructions for building and setting up the aircraft part</div><p>test test</p></div><div class=td-content><h1 id=pg-dc56973d26ddd1ffb1dd1113ee13801d>4.1 - UAV Power</h1><div class=lead>Battery and power systems for the UAV</div><p>The Peregrine system uses <a href=https://www.zohd.net/lionpack>ZOHD Lionpack 18650 4S1P</a> batteries. <a href=https://www.getfpv.com/zohd-lionpack-18650-4s1p-3500mah-14-8v-li-ion-battery.html>GetFPV</a> is a good source for them.</p><p>Either one or two battery packs may be used (in parallel if two) depending on the flight time required.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-09d1c2e6fa237eb543abf8a55cc772dc>5 - Other Resources</h1><div class=lead>Other resources and tips</div><div class="pageinfo pageinfo-primary"></div></div><div class=td-content><h1 id=pg-aca7e25603b179d2271831f189bef5f0>5.1 - Sourcing Custom Parts</h1><div class=lead>Suggestions for getting custom parts made</div><p>Many of the parts used to build Peregrine are custom designs. In some instances,
these may be things you can build yourself if you have the right tools
(3D printer, laser cutter, etc). In almost all cases, however, it is also
possible to use our provided design files to order parts from reliable vendors.
For each type of manufacturing, this page includes some notes about how we
produce parts or which external vendors we have worked with.</p><p>You can find design files for the hardware components of Peregrine in the
<a href=https://github.com/thomasteisberg/peregrine_hardware>Peregrine Hardware repository</a>.</p><h2 id=3d-printing>3D Printing</h2><p>All of our designs rely heavily on 3D printing. We use a
<a href=https://www.prusa3d.com/category/original-prusa-i3-mk3s/>Prusa MK3S+</a> and
<a href=https://www.prusa3d.com/product/prusament-asa-lipstick-red-850g/>Prusament ASA Lipstick Red</a>
filament.</p><p>All of our designs should be printable on any common FDM printer.</p><p>Outsourced 3D printing is expensive relative to the low costs of desktop 3D
printers, especially for parts (like ours) that generally don&rsquo;t need sub-mm
tolerances. That said, there many 3D printing services. I have had good
experiences with <a href=https://www.shapeways.com/>Shapeways</a>. If you have a vendor
produce your parts and you are intending to use them in a UAV, be sure to
specify that you don&rsquo;t want them to be printed solid. We usually print at about
20% infill density. Solid parts will weigh a lot more.</p><p>ASA is our plastic of choice because it forms parts that are relatively strong,
relatively light weight, work over an extended temperature range, and suffer
minimal UV degradation. The downside is that it is somewhat more difficult to
print with, as compared to PLA filament. We use an enclosure to provide a heated
build volume. Almost all prints are done with a brim (setting available in your
slicing software) to avoid warping.</p><p>PLA is great for prototyping but likely not a good choice for critical outdoor
applications. PLA can easily get hot enough to warp in direct sunlight and may
degrade under extended exposure to UV.</p><p>ABS or other similar materials should be fine.</p><p>Note that filament type, nozzle size, and slicing settings will all make a big
difference to the final weight of your parts.</p><h2 id=laser-cutting>Laser Cutting</h2><p>All laser cut parts are produced by <a href=https://sendcutsend.com/>SendCutSend</a>.
Ponoko, Xometry, and many other options also exist. If you want to match our
materials exactly, though, SendCutSend will be easiest.
If you have a laser cutter, you could also make them yourself.</p><h2 id=cnc-machining>CNC Machining</h2><p>We usually have CNC machined parts made through <a href=https://www.hubs.com/>HUBS</a>,
which distributes jobs to a network of machine shops. They are not the cheapest
option, but they provide a nice balance between cost, speed, and reliability.</p><h2 id=printed-circuit-boards-pcbs-and-pcb-assembly>Printed Circuit Boards (PCBs) and PCB Assembly</h2><p>You can send most of our design files to any PCB shop you like working with.</p><p>The one exception are the Peregrine under-wing antennas, which are larger
(about 56 cm by 11 cm) than the maximum dimensions allowed for standard orders
at many PCB manufacturers. Additionally, we usually get these printed on thinner
FR4 to reduce weight. These two factors make them very expensive at some board
shops. <a href=https://www.pcbway.com/>PCBWay</a> will produce 5 (un-assembled boards)
for less than $150 including shipping to the US.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/radioglaciology/uhd_radar aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>Anna Broome and Thomas Teisberg</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><p class="td-footer__about mt-2"><a href=https://orca.hisnr.com/about/>Contributors, Citations, Contact Info, and Acknowledgements</a></p></div></div></div></footer></div><script src=https://orca.hisnr.com/js/main.min.55a5ebb52e389e6bb3eb51bb72a971bb4aa19da2885a57d87391e32159086995.js integrity="sha256-VaXrtS44nmuz61G7cqlxu0qhnaKIWlfYc5HjIVkIaZU=" crossorigin=anonymous></script><script defer src=https://orca.hisnr.com/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://orca.hisnr.com/js/tabpane-persist.js></script></body></html>