<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://orca.hisnr.com/docs/><link rel=alternate type=application/rss+xml href=https://orca.hisnr.com/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=https://orca.hisnr.com/favicons/favicon.ico><link rel=apple-touch-icon href=https://orca.hisnr.com/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://orca.hisnr.com/favicons/android-192x192.png sizes=192x192><title>Documentation | Open Radar Code Architecture</title>
<meta name=description content="Documentation for ORCA"><meta property="og:url" content="https://orca.hisnr.com/docs/"><meta property="og:site_name" content="Open Radar Code Architecture"><meta property="og:title" content="Documentation"><meta property="og:description" content="This is a placeholder page that shows you how to use this template site.
This section is where the user documentation for your project lives - all the information your users need to understand and successfully use your project.
For large documentation sets we recommend adding content under the headings in this section, though if some or all of them don’t apply to your project feel free to remove them or add your own. You can see an example of a smaller Docsy documentation site in the Docsy User Guide, which lives in the Docsy theme repo if you’d like to copy its docs section."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Documentation"><meta itemprop=description content="This is a placeholder page that shows you how to use this template site.
This section is where the user documentation for your project lives - all the information your users need to understand and successfully use your project.
For large documentation sets we recommend adding content under the headings in this section, though if some or all of them don’t apply to your project feel free to remove them or add your own. You can see an example of a smaller Docsy documentation site in the Docsy User Guide, which lives in the Docsy theme repo if you’d like to copy its docs section."><meta itemprop=dateModified content="2024-06-09T15:38:29-01:00"><meta itemprop=wordCount content="157"><meta name=twitter:card content="summary"><meta name=twitter:title content="Documentation"><meta name=twitter:description content="This is a placeholder page that shows you how to use this template site.
This section is where the user documentation for your project lives - all the information your users need to understand and successfully use your project.
For large documentation sets we recommend adding content under the headings in this section, though if some or all of them don’t apply to your project feel free to remove them or add your own. You can see an example of a smaller Docsy documentation site in the Docsy User Guide, which lives in the Docsy theme repo if you’d like to copy its docs section."><link rel=preload href=https://orca.hisnr.com/scss/main.min.d180a40143076fc2b4d710452bc5b57c3b4fb1e656d592a0d78a47a66d00a5df.css as=style><link href=https://orca.hisnr.com/scss/main.min.d180a40143076fc2b4d710452bc5b57c3b4fb1e656d592a0d78a47a66d00a5df.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=https://orca.hisnr.com/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Open Radar Code Architecture</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/docs/radar/><i class='fa-solid fa-gears'></i><span>ORCA Software-Defined Radar Guide</span></a></li><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/docs/mapperr/><i class='fa-solid fa-map'></i><span>MAPPERR</span></a></li><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/docs/peregrine/><i class='fa-solid fa-plane-departure'></i><span>Peregrine</span></a></li><li class=nav-item><a class=nav-link href=https://orca.hisnr.com/about/><i class='fa-solid fa-people-group'></i><span>About</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=https://orca.hisnr.com/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Documentation</h1><ul><li>1: <a href=#pg-35c24791b3a374739f7e6d02f1c3958e>ORCA Software-Defined Radar</a></li><ul><li>1.1: <a href=#pg-3beab2e3d8603c86e524a0b9ab6bae58>Radar Code</a></li><ul><li>1.1.1: <a href=#pg-3aa97dd7fbd24041ce0fdb52cba4bfd9>Compatible hardware</a></li><li>1.1.2: <a href=#pg-8538062d5075a8e980d0dc57578bbd42>Code overview</a></li><li>1.1.3: <a href=#pg-aab8793a6a9d377b03b3ed408d27fdbb>Configuration options</a></li><li>1.1.4: <a href=#pg-f54dda5cb6ea911492719f02a852a441>Host computer transport parameter tuning</a></li></ul><li>1.2: <a href=#pg-09330e41588626b269ce92ebb8f4b4ec>Postprocessing</a></li><ul><li>1.2.1: <a href=#pg-5bdc3eb38338c1ba9cd8687c226ed4de>File Formats</a></li><li>1.2.2: <a href=#pg-b02afc278dc1a8009849113c17d595fc>Processing Functions</a></li><li>1.2.3: <a href=#pg-14a4f29f8818ee6f2f782bbfa8403f94>Postprocessing Notebooks</a></li><li>1.2.4: <a href=#pg-aa8065218e85e6f199f149efce5cd0aa>Timing and timestamping</a></li></ul></ul><li>2: <a href=#pg-795007577fe9f887f0c83937d03b3ee9>Peregrine UAV-Borne Radar</a></li><ul><li>2.1: <a href=#pg-cf252ce1f79916435033b3619324bc8b>Peregrine Payload</a></li><ul><li>2.1.1: <a href=#pg-5c54d50aa1e0b71de4f09d9fc05813b2>Peregrine Radar Payload Box Assembly</a></li><ul></ul><li>2.1.2: <a href=#pg-7d2801d0e482f63a6a7d9bbfb01e045d>Raspberry Pi Setup</a></li><ul><li>2.1.2.1: <a href=#pg-261150229039da055a29b5b51b4e72e7>Connecting to the Raspberry Pi</a></li><li>2.1.2.2: <a href=#pg-9e1cddaa6d9341ed8eb6a9978b03ad7e>Debugging: Real-Time Clocks (RTC)</a></li><li>2.1.2.3: <a href=#pg-cbee3f51f0dda6860ef7e3ca0ee7785a>Customizing user-data</a></li><li>2.1.2.4: <a href=#pg-61db8ec95a554267e86e9456c1179522>Raspberry Pi Network Connection</a></li><ul></ul></ul><li>2.1.3: <a href=#pg-4c89c29d53af73eddf3d18c23c181774>Data Storage Options</a></li><li>2.1.4: <a href=#pg-7dcd91265f5b85793c574a265a4f3e68>External button</a></li><ul></ul></ul><li>2.2: <a href=#pg-5ff86ec97550a3558ce99a1679a497ab>5V Power Board and Power Harnesses</a></li><ul></ul><li>2.3: <a href=#pg-c753e93257e93b91e94aba20cb857012>Peregrine Radar Operating Instructions</a></li><ul><li>2.3.1: <a href=#pg-2d67bd174f92eee89f4c4bcb39fc874c>Logger Service Setup</a></li><ul></ul><li>2.3.2: <a href=#pg-4d3881fa475af65bab19cad623617626>Radar Service Setup</a></li><ul></ul></ul><li>2.4: <a href=#pg-88cc421379ba8b45e0513dd66c9c1425>UAV Setup</a></li><ul><li>2.4.1: <a href=#pg-dc56973d26ddd1ffb1dd1113ee13801d>UAV Power</a></li><ul></ul></ul><li>2.5: <a href=#pg-09d1c2e6fa237eb543abf8a55cc772dc>Other Resources</a></li><ul><li>2.5.1: <a href=#pg-aca7e25603b179d2271831f189bef5f0>Sourcing Custom Parts</a></li></ul></ul><li>3: <a href=#pg-878df201f7f734521f1896561fb0eb90>MAPPERR Multi-frequency Radar</a></li><ul><li>3.1: <a href=#pg-fe4e9ca99da5ce4362052e329f655d25>MAPPERR Core Hardware</a></li><ul><li>3.1.1: <a href=#pg-39d90f0be7a22239646ae3e9305a7bb3>Alternative MAPPERR Configurations</a></li><ul></ul></ul><li>3.2: <a href=#pg-86efaba9588e5d291b8386249f3e783d>MAPPERR Antennas</a></li><ul></ul><li>3.3: <a href=#pg-4613f0315825d535c9026a48446963e0>Towing MAPPERR</a></li><ul></ul></ul><li>4: <a href=#pg-9e890912a199497805ced8ceeb3b219b>SORA Sled-Towed Radar</a></li><ul></ul><li>5: <a href=#pg-fc18e26190a35ff069b2aecd8dd50f71></a></li></ul><div class=content><div class="pageinfo pageinfo-primary"><p>This is a placeholder page that shows you how to use this template site.</p></div><p>This section is where the user documentation for your project lives - all the
information your users need to understand and successfully use your project.</p><p>For large documentation sets we recommend adding content under the headings in
this section, though if some or all of them don’t apply to your project feel
free to remove them or add your own. You can see an example of a smaller Docsy
documentation site in the <a href=https://docsy.dev/docs/>Docsy User Guide</a>, which
lives in the <a href=https://github.com/google/docsy/tree/master/userguide>Docsy theme
repo</a> if you&rsquo;d like to
copy its docs section.</p><p>Other content such as marketing material, case studies, and community updates
should live in the <a href=https://orca.hisnr.com/about/>About</a> and <a href=https://orca.hisnr.com/community/>Community</a> pages.</p><p>Find out how to use the Docsy theme in the <a href=https://docsy.dev/docs/>Docsy User
Guide</a>. You can learn more about how to organize your
documentation (and how we organized this site) in <a href=https://docsy.dev/docs/best-practices/organizing-content/>Organizing Your
Content</a>.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-35c24791b3a374739f7e6d02f1c3958e>1 - ORCA Software-Defined Radar</h1><div class="pageinfo pageinfo-primary"><p>For a general overview of the ORCA system, we highly recommend reading through
our publication:</p><blockquote><p>T. O. Teisberg, A. L. Broome and D. M. Schroeder, &ldquo;Open Radar Code Architecture (ORCA): A Platform for Software-Defined Coherent Chirped Radar Systems,&rdquo; in <em>IEEE Transactions on Geoscience and Remote Sensing</em>, vol. 62, pp. 1-11, 2024, Art no. 5109411, doi: 10.1109/TGRS.2024.3446368.</p></blockquote></div><p>The documentation is broken into two parts. <a href=https://orca.hisnr.com/docs/radar/sdr-interface/>Radar Code</a> covers everything about
the code that runs while the radar is actively collecting data. The
<a href=https://orca.hisnr.com/docs/radar/postprocessing/>Postprocessing</a>
section explains how data is saved and explains the basic processing scripts that
we provide.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3beab2e3d8603c86e524a0b9ab6bae58>1.1 - Radar Code</h1><div class=lead>Overview of SDR-interfacing code</div></div><div class=td-content><h1 id=pg-3aa97dd7fbd24041ce0fdb52cba4bfd9>1.1.1 - Compatible hardware</h1><div class=lead>Options for SDR hardware and host computers</div><h2 id=selecting-a-software-defined-radio-sdr>Selecting a Software-Defined Radio (SDR)</h2><p>ORCA is built upon the <a href=https://github.com/EttusResearch/uhd>USRP Hardware Driver</a> (UHD).
As such, it is theoretically compatible with any <a href=https://www.ettus.com>Ettus</a> SDR.
We have primarily tested with B and X series devices (B205mini and X310, in particular),
however most other Ettus SDRs should work with minor tweaks.</p><p>The basic capabilities of the two models we regularly use are detailed below:</p><table><thead><tr><th>SDR</th><th>Frequency Range (GHz)</th><th>Bandwidth (MHz)</th><th>Channels</th><th>Mass (kg)</th><th>Approximate Cost (USD)</th></tr></thead><tbody><tr><td><a href=https://www.ettus.com/all-products/x310-kit/>X310</a> with <a href=https://www.ettus.com/all-products/ubx160/>UBX160</a></td><td>0.01-6</td><td>200</td><td>2 TX, 2 RX</td><td>1.7</td><td>$14,0000</td></tr><tr><td><a href=https://www.ettus.com/all-products/usrp-b205mini-i/>B205mini-i</a></td><td>0.07-6</td><td>56</td><td>1 TX, 1 RX</td><td>0.024</td><td>$1,600</td></tr></tbody></table><p>In general, we recommend B series devices for applications with constraints on
size, weight, power, or budget. When capabilities beyond the B series are needed,
we recommend the X series.</p><p>If no device in either series suits your needs, consider other Ettus SDRs. Most
should work with minor tweaks. The exception to note are E series devices, which
include an embedded computer
running Linux. In theory, this code could be run on that embedded computer,
however the performance limitations would limit the use cases.</p><h2 id=host-computer>Host Computer</h2><p>Unless you choose an E series device (see caution above), you will also need a
computer to interface with the SDR. This computer is where the ORCA code will
run.</p><p>The capabilities of the computer can make a significant difference in the
system performance. The host computer must support an interface with enough
bandwidth for the samples you want to transfer and be able to store these
samples to an appropriate storage medium.</p><p>If you&rsquo;re not resource constrained, a modern laptop will provide more than
enough processing power, as long as it supports the interface you need. Keep in
mind that X-series SDRs need a 10 gigabit ethernet (10 GigE) interface to achieve maximum
sample rates. Few laptops natively support 10 GigE, however there are
Thunderbolt adapters available. (Not all USB C ports support Thunderbolt and
it may not be available on low-end laptops.)</p><p>For an embedded solution, Raspberry Pi&rsquo;s are suitable for working with B series
devices. The performance of the Raspberry Pi 5 greatly exceeds the Raspberry Pi
4, likely due to the introduction of a new USB interface chip.</p><p>Some caution is advised with other single-board computers. Their performance will
likely be limited by their choice of USB controller chip.</p><p>For some examples of duty cycles achievable with various combinations of SDRs
and host computers, see the figure below. Note that actual performance will
depend on a variety of factors, including your exact configuration and the
speed of your storage medium.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:490px><img class=card-img-top src=https://orca.hisnr.com/docs/radar/sdr-interface/hardware/duty_cycle_comparison_with_pi5_hu_aecdfdb98cd8ba8b.png width=480 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Example results from running <code>error_code_late_command_sweep.py</code> on several
combinations of host computers and SDRs.</p></p></figcaption></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-8538062d5075a8e980d0dc57578bbd42>1.1.2 - Code overview</h1><div class=lead>Overview of the code&rsquo;s architecture</div><h2 id=conda-environment-setup>Conda environment setup</h2><p>All of the required dependencies can be installed as a conda environment using
the <code>environment.yaml</code> file in the repository. More instructions can be found
in the <a href="https://github.com/radioglaciology/uhd_radar/tree/main?tab=readme-ov-file#configuring-your-environment">README</a>
file.</p><h2 id=startup-scripts>Startup scripts</h2><p>The X series devices require some initial network configuration. For convenience,
a <a href=https://github.com/radioglaciology/uhd_radar/blob/main/x310_startup.sh>startup script</a>
is provided to automate this setup. You may need to tweak this file to your setup.</p><h2 id=runner-scripts>Runner scripts</h2><p>The basic steps required to run the radar are:</p><ol><li>Build the C++ code</li><li>Generate a chirp file to transmit based on your configuration</li><li>Run the compiled radar code</li><li>Move the collected data to an appropriate location</li></ol><p>The main interface for running the radar code is through <code>run.py</code>, a Python
script designed to automate the above process. This script is run as follows:</p><pre tabindex=0><code>python run.py config/my_radar_configuration.yaml
</code></pre><p>At the end of the data collection, data will be saved with the current date
to a location specified in the <a href=https://orca.hisnr.com/docs/radar/sdr-interface/config/>YAML config file</a>.</p><p>Generally, three files are saved:</p><ul><li><code>YYYYMMDD_hhmmss_rx_samps.bin</code> - This is a binary file containing the raw
samples recorded the SDR. Note that this file is not interpretable unless you
also have the config file used.</li><li><code>YYYYMMDD_hhmmss_config.yaml</code> - This is the YAML config file passed to <code>run.py</code>.
It defines all parameters of the data collection, allowing for the <code>rx_samps.bin</code>
file to be interpreted and processed.</li><li><code>YYYYMMDD_hhmmss_uhd_stdout.log</code> - This is a text file containing the output
of running the radar code. This is helpful for debugging and also contains a log
of any errors encountered, which may be required to reconstruct the timing of
each recording.</li></ul><p>More details on the files stored and how these can be re-processed into a Zarr
file are on the <a href=https://orca.hisnr.com/docs/radar/postprocessing/files/>file formats</a> page.</p><p>Note that there are also settings available to break <code>rx_samps.bin</code> into multiple
files as needed.</p><h2 id=sdr-interface-code>SDR interface code</h2><p>For performance reasons, the code directly interfacing with the SDR is written
in C++. This code is all located in the <code>sdr/</code> directory of the repository.</p><p>The main radar code is contained in <code>main.cpp</code> (with some SDR setup code located
in <code>rf_settings.cpp</code>). The radar code runs in two threads, as shown in the
figure below.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:510px><img class=card-img-top src=https://orca.hisnr.com/docs/radar/sdr-interface/code/code_diagram_hu_a24296848958957.png width=500 height=889><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>General architecture of the ORCA code</p></p></figcaption></figure><p>One thread is responsible for scheduling
<a href=https://kb.ettus.com/Synchronizing_USRP_Events_Using_Timed_Commands_in_UHD>timed commands</a>
that are enqueued into FIFO queues within the SDR&rsquo;s FPGA.</p><p>The other thead is responsible for pulling received samples from the SDR and
writing them to a file on the host computer.</p><p>For a more complete overview, please refer to our paper:</p><blockquote><p>T. O. Teisberg, A. L. Broome and D. M. Schroeder, &ldquo;Open Radar Code Architecture (ORCA): A Platform for Software-Defined Coherent Chirped Radar Systems,&rdquo; in <em>IEEE Transactions on Geoscience and Remote Sensing</em>, vol. 62, pp. 1-11, 2024, Art no. 5109411, doi: 10.1109/TGRS.2024.3446368.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-aab8793a6a9d377b03b3ed408d27fdbb>1.1.3 - Configuration options</h1><div class=lead>All of the options in <code>config.yaml</code></div><p>The entire configuration that controls the radar is defined in a single configuration file. This file is provided at runtime to <code>run.py</code> and encapsulates all of the settings needed to run various experiments on different hardware setups. Configuration files are specified in the YAML format and contained in the <code>config/</code> folder of the ORCA repository. Default configuration files are included to run the code on a B205mini-i (<code>default_b205.yaml1</code>) and on an X310 (<code>default_x310.yaml</code>). Here we explain the basics behind the settings available to the user via the config file.</p><h3 id=chirp-and-pulse-parameters>Chirp and Pulse Parameters</h3><ul><li><code>sample_rate</code>: Sample rate of the generated chirp (used as TX and RX rate too), specified in Hz<ul><li>On the X310, the sample rate should be an even integer division of the main clock rate</li></ul></li><li><code>chirp_type</code>: Chirp frequency progression type<ul><li>Supported options: &ldquo;linear&rdquo;, &ldquo;hyperbolic&rdquo;</li></ul></li><li><code>chirp_bandwidth</code>: Bandwidth of the chirp, specified in Hz<ul><li>Should be less than or equal to <code>sample_rate</code> to satisfy Nyquist</li></ul></li><li><code>lo_offset_sw</code>: Center frequency of the chirp, relative to <code>RF0:freq</code> (the RF center frequency), specified in Hz</li><li><code>window</code>: Window function applied to the chirp<ul><li>Supported options: &ldquo;rectangular&rdquo;, &ldquo;hamming&rdquo;, &ldquo;blackman&rdquo;, &ldquo;kaiser10&rdquo;, &ldquo;kaiser14&rdquo;, &ldquo;kaiser18&rdquo;</li><li>Applied on transmit and receive by default</li></ul></li><li><code>chirp_length</code>: Chirp length without zero padding, specified in seconds</li><li><code>pulse_length</code>: Total pulse length (chirp + symmetric zero padding), specified in seconds<ul><li>set equal to <code>chirp_length</code> if no zero padding is desired</li></ul></li><li><code>out_file</code>: Name of the output binary file containing pulse samples</li><li><code>show_plot</code>: Whether to display a time-domain plot of the generated chirp (True or False)</li></ul><h3 id=device-connection-and-data-transfer-parameters>Device Connection and Data Transfer Parameters</h3><ul><li><code>device_args</code>: USRP device arguments are used to identify specific SDRs (if multiple areconnected to the same computer), to configure model-specific parameters, and to set transport parameters of the link (USB, ethernet) between the SDR and the host computer.<ul><li>See the default config file or Ettus UHD examples for the SDR you wish to use to set appropriately</li></ul></li><li><code>subdev</code>: Active SDR submodules<ul><li>See the default config file or Ettus UHD examples for the SDR you wish to use to set appropriately</li></ul></li><li><code>clk_ref</code>: SDR clock reference source<ul><li>Supported options: &ldquo;internal&rdquo;, &ldquo;external&rdquo;, &ldquo;gpsdo&rdquo;</li><li>&ldquo;external&rdquo; requires an external clock reference connected to the SDR</li><li>&ldquo;gpsdo&rdquo; requires a GPSDO module to be installed on the SDR</li></ul></li><li><code>clk_rate</code>: SDR main clock frequency, specified in Hz<ul><li>only specific frequencies are allowable for each SDR, see Ettus documentation for more information</li></ul></li><li><code>tx_channels</code>: list of TX channels to use (comma separated)</li><li><code>rx_channels</code>: list of RX channels to use (comma separated)</li><li><code>cpu_format</code>: CPU-side sample format<ul><li>Supported options: &ldquo;fc32&rdquo;, &ldquo;sc16&rdquo;, &ldquo;sc8&rdquo;</li></ul></li><li><code>otw_format</code>: On the wire format<ul><li>any format supported</li></ul></li></ul><h3 id=gpio-configuration-parameters>GPIO Configuration Parameters</h3><p>Many of the Ettus SDRs have GPIO pins which can be used for conveying automatic transmit/receive signals or other general signals to external devices. The parameters in this section are specific to how MAPPERR and PEREGRINE use the SDR GPIO and can be adapted for other use cases.</p><ul><li><code>gpio_bank</code>: Which GPIO bank to use<ul><li>&ldquo;FP0&rdquo; is the front panel and default bank on the X310</li></ul></li><li><code>pwr_amp_pin</code>: Which GPIO pin to use fo external power amplifier control<ul><li>set to &ldquo;-1&rdquo; if not using</li></ul></li><li><code>ref_out</code>: Turns the 10 MHz reference out signal on the X310 on (1) or off (0)<ul><li>set to (-1) if the SDR does not support a 10 MHz reference out signal</li></ul></li></ul><h3 id=rf-frontend-0-configuration-parameters>RF Frontend 0 Configuration Parameters</h3><p>RF configuration parameters for a single-channel radar setup.</p><ul><li><code>rx_rate</code>: RX sample rate, specified in Hz<ul><li>defaults to be equal to <code>sample_rate</code></li></ul></li><li><code>tx_rate</code>: TX sample rate, specified in Hz<ul><li>defaults to be equal to <code>sample_rate</code></li></ul></li><li><code>freq</code>: Center frequency (LO/mixer frequency), specified in Hz</li><li><code>lo_offset</code>: hardware LO/mixer offset, specified in Hz</li><li><code>rx_gain</code>: RX gain, specified in dB<ul><li>available gain range dependent on specific SDR</li></ul></li><li><code>tx_gain</code>: TX gain, specified in dB<ul><li>available gain range dependent on specific SDR</li></ul></li><li><code>bw</code>: Configurable hardware filter bandwidth, specified in Hz<ul><li>not supported on all SDRs</li><li>set to 0 if not supported</li></ul></li><li><code>tx_ant</code>: Port to be used for TX</li><li><code>rx_ant</code>: Port to be used for RX</li><li><code>transmit</code>: Whether to transmit data samples or not<ul><li>set to &ldquo;true&rdquo; (or leave blank) to transmit samples (normal operation)</li><li>set to &ldquo;false&rdquo; to completely disable transmit</li></ul></li><li><code>tuning_args</code>: Set integer-N or fractional tuning arguments<ul><li>only supported on some SDRs</li><li>leave as "" to do nothing</li></ul></li></ul><h3 id=rf-frontend-1-configuration-parameters>RF Frontend 1 Configuration Parameters</h3><p>RF configuration parameters for the second channel of a multi-channel radar setup. This is only supported on SDRs with more than 2 TX/RX ports. Parameters are the same as in RF Frontend 0 Configuration.</p><h3 id=pulse-timing-parameters>Pulse Timing Parameters</h3><ul><li><code>time_offset</code>: Offset time after set up before the first received sample, specified in seconds</li><li><code>tx_duration</code>: Transmission duration, specified in seconds<ul><li>defaults as, and should be, equal to <code>pulse_length</code></li></ul></li><li><code>rx_duration</code>: Receive duration, specified in seconds<ul><li>should be long enough to capture echoes from the expected most distant target</li></ul></li><li><code>pulse_rep_int</code>: pulse repetition interval, specified in seconds<ul><li>should be longer than or equal to <code>rx_duration</code></li></ul></li><li><code>error_recovery_time</code>: Additional time added (on top of <code>pulse_rep_int</code>) to the next scheduled set of commands after an error occurs.<ul><li>Most errors are due to a command being enqueued too late, so providing some extra buffer time lets the host computer &ldquo;catch up&rdquo;</li></ul></li><li><code>tx_lead</code>: Time between start of TX and RX, specified in seconds<ul><li>can be used for psuedo-blanking</li></ul></li><li><code>num_pulses</code>: Number of chirps/pulses to transmit and receive<ul><li>set to -1 to continuously transmit and record until stopped by CTRL-C</li><li>code will record <code>num_pulses</code> of error-free pulses before terminating</li></ul></li><li><code>num_presums</code>: Number of received pulses to coherently average before writing to file</li><li><code>phase_dithering</code>: Whether to enable phase dithering or not</li></ul><h3 id=during-recording-file-location-parameters>During Recording File Location Parameters</h3><ul><li><code>chirp_loc</code>: Which chirp file to transmit<ul><li>in most cases, should be the same as <code>out_file</code></li></ul></li><li><code>save_loc</code>: (Temporary) location to write received samples to</li><li><code>gps_loc</code>: (Temporary) location to save GPS data<ul><li>only works if &ldquo;gpsdo&rdquo; is selected for <code>clk_ref</code></li></ul></li><li><code>max_chirps_per_file</code>: Maximum number of chirps (after presumming) to write to a single file<ul><li>set to -1 to avoid breaking into multiple files</li></ul></li></ul><h3 id=file-save-locations-for-runpy>File Save Locations for run.py</h3><p>These settings are only used by <code>run.py</code>, they are not read by <code>main.cpp</code>.</p><ul><li><code>final_save_loc</code>: Save location for the big final file, set to <code>null</code> if you don&rsquo;t want to save a big file<ul><li>if <code>max_chirps_per_file</code> -= -1 (i.e. all data will be written directly to a single file), then final_save_loc and save_partial_files will be ignored</li></ul></li><li><code>save_partial_files</code>: Set to True if you want individual small files to be copied with the timestamp, set to False if you just want the big merged file to be copied with the timestamp<ul><li>if <code>max_chirps_per_file</code> == -1 (i.e. all data will be written directly to a single file), then final_save_loc and save_partial_files will be ignored</li></ul></li><li><code>save_gps</code>: Set to True if using GPS and wanting to save GPS location data, set to False otherwise</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f54dda5cb6ea911492719f02a852a441>1.1.4 - Host computer transport parameter tuning</h1><div class=lead>Overview of host interface tuning to achieve maximum duty cycle</div><p>The maximum duty cycle you can achieve is a function of the SDR you use, the
host computer, and the bandwidth you need. This page outlines suggestions for
how to figure out an achievable duty cycle and what parameters can be tweaked
to maximize this.</p><h2 id=general-process-for-benchmarking-duty-cycle>General process for benchmarking duty cycle</h2><h3 id=determine-the-maximum-achievable-bandwidth-with-benchmark_rate>Determine the maximum achievable bandwidth with benchmark_rate</h3><p>Use the USRP example benchmark_rate program (located at
<code>&lt;path to conda install>/envs/&lt;uhd environment name>/lib/uhd/examples</code>) to
determine the approximate maximum duty cycle you can achieve. For instance, with
a Pi 4 and b205mini, I can reach about a 25% duty cycle &ndash; defined as sample
rate divided by desired sample rate (14 Msps / 56 Msps in this case) &ndash; while
consistently getting 0 dropped packets.</p><pre tabindex=0><code>./benchmark_rate --tx_rate 14e6 --rx_rate 14e6 --tx_otw sc12 --rx_otw sc12 --args=&#34;num_recv_frames=512,num_send_frames=512,recv_frame_size=16000,send_frame_size=16000&#34;
</code></pre><p>This is also the stage to experiment with what transport parameters allow for
the highest throughput on your combination of computer/interface/SDR. However
the choice of (send/recv)_frame_size should be based on the number of samples
per chirp and won’t have the same kind of impact in this continuous streaming
case. In other words, you can get close but more tweaking later will help &ndash;
probably.</p><p>Read about
<a href=https://files.ettus.com/manual/page_transport.html>USB transport parameters on the Ettus website</a>.</p><h3 id=figure-out-desired-pulse-lengths-rx-and-tx-and-set-frame-sizes-appropriately>Figure out desired pulse lengths (RX and TX) and set frame sizes appropriately</h3><p>Basically you want one full set of received samples to fit in a frame.
See many more details about this in “Transport layer - throughput limitations”
below.</p><h3 id=run-testserror_code_late_command_sweeppy-to-figure-out-your-max-duty-cycle>Run <code>tests/error_code_late_command_sweep.py</code> to figure out your max duty cycle</h3><p>This will sweep across effective duty cycles from 100% to 1, testing the
equivalent pulse_rep_int for each one. The script produces a plot (saved as
<code>error_code_late_command.png</code>) that shows percent of errors versus duty cycle.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:490px><img class=card-img-top src=https://orca.hisnr.com/docs/radar/sdr-interface/host-interface/duty_cycle_comparison_with_pi5_hu_aecdfdb98cd8ba8b.png width=480 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Example results from running <code>error_code_late_command_sweep.py</code> on several
combinations of host computers and SDRs.</p></p></figcaption></figure><h2 id=tuning-transport-parameters>Tuning transport parameters</h2><p>In addition to getting late commands, the other issues we can run into are
overflows (D on network-based devices, O on other devices) and underflows (U on
all devices). There are also sequence errors (S) that often go along with late
commands (L). Overflows mean that the buffers filled up and samples from the SDR
are not being consumed fast enough. Underflows mean that the SDR did not receive
samples to transmit before it needed to transmit those samples.</p><p>The Ettus knowledge base has a page detailing
<a href=https://kb.ettus.com/About_USRP_Bandwidths_and_Sampling_Rates>theoretical maximum transfer rates for each device</a>.</p><p>Depending on the device, data is transferred over USB using libUSB, GigE, 10GigE,
or PCI-E. For each option, there are various tunable parameters that impact the
packet sizes and buffers used.</p><p>For <code>libUSB</code>, the transport parameters are:</p><p><code>(send/recv)_frame_size</code> is the maximum packet payload size in bytes. The
maximum number of samples that fits into a packet is <code>&lt;packet size in bytes>/&lt;bytes per sample></code>.
The bytes per sample is determined by the over-the-wire format
(see <a href=https://files.ettus.com/manual/structuhd_1_1stream__args__t.html><code>otw_format</code></a>).
For example, <code>sc12</code> requires 24 bit/samples, which is 3 bytes. It’s named <code>sc12</code>
because each value is 12 bits, but there are two values per samples (I, Q).</p><p>You can query the max number of samples based on your selected
<code>(send/recv)_frame_size</code> through the TX or RX streamers:
<code>tx_stream->get_max_num_samps()</code> or <code>rx_stream->get_max_num_samps()</code></p><p>The default is around 8 MB (on my laptop and on the Pi 4B, both running
Ubuntu-derived variants). If you set it too high, you&rsquo;ll get an error message.</p><p>In most cases one full chirp (TX) or the received samples associated with one
full chirp should fit and a good choice is to set the frame sizes to be equal to
(or just barely larger than) the expected number of TX and RX samples,
respectively, per chirp.</p><p><code>num_(send/recv)_frames</code> controls how many buffers of size
<code>(send/recv)_frame_size</code> are created. The more buffers you allocate for
receiving, the longer your host program can lag for before causing an overflow.</p><p>LibUSB will give you a memory error if you try to allocate too much memory
overall (roughly frame size * number of frames).</p><p>This is also why you don’t want arbitrarily large frame sizes. You end up
wasting RAM if you’re allocating buffers that are longer than the maximum packet
size you expect.</p><p><code>num_recv_frames</code> is one of the most commonly talked about points on the USRP
mailing list for throughput issues on the b2xx devices. Apparently the default
value is very small (though I wasn’t able to figure out how to find the actual
default).</p><p>You set these parameters in the device arguments string. For us, that means
something like this in the config YAML:</p><pre tabindex=0><code>device_args: &#34;num_recv_frames=700,num_send_frames=700,recv_frame_size=11000,send_frame_size=11000&#34;
</code></pre><p>As described above, the USRP example program benchmark_rate is very useful for
playing with these parameters quickly and figuring out what the limits are.</p><p>The host side matters a lot here too. The amount of RAM available on the host
directly limits the <code>num_(send/recv)_frames</code>. Processing speed of the host in
general can easily be the bottleneck. Finally, some USB 3.0 controllers are
known to work better than others. The Ettus knowledge base used to have a table
of performance on a few selected USB controllers. An archive of that page is
available <a href=https://web.archive.org/web/20160421212045/https://www.ettus.com/kb/detail/usrp-b200-and-b210-usb-30-streaming-rate-benchmarks>here</a>.</p><p>(The Pi 4 uses a VL805 controller. The Pi 5 has a new USB controller that performs far better.)</p></div><div class=td-content style=page-break-before:always><h1 id=pg-09330e41588626b269ce92ebb8f4b4ec>1.2 - Postprocessing</h1><div class=lead>Working with data recorded using ORCA</div><p>ORCA provides pre-processing and post-processing code that supports operation of SDRs as chirped radar systems. These functions are meant to provide basic support and analysis for ice-penetrating radar data. More advanced processing can be built off this code. While we built this code to process data collected with radars running ORCA, we hope that the documentation makes it flexible enough to process other forms of ice-penetrating radar data as well.</p><h3 id=data-format>Data Format</h3><h3 id=pre-processing-functions>Pre-processing Functions</h3><p>Pre-processing functions available in ORCA are centered around waveform (chirp) generation. They are found in the <code>preprocessing/</code> folder of the main repo.</p><ul><li><code>preprocessing/generate_chirp.py</code> Generates digital IQ (in-phase and quadrature) samples based on configuration parameters provided in a YAML configuration file<ul><li>Support for the following window functions is currently provided: Rectangular, Hamming, Blackman-Harris, Kaiser10, Kaiser14, and Kaiser18</li><li>We have found <a href=https://holometer.fnal.gov/GH_FFT.pdf>this document by G. Heinzel and others</a> to be a very useful resource for understanding and implementing window functions</li></ul></li></ul><h3 id=post-processing-functions>Post-processing Functions</h3><p>A variety of post-processing functions are available in ORCA, ranging from basic radar processing, to radar system coherence characterization.</p><ul><li><code>processing.py</code></li><li><code>processing_dask.py</code></li><li><code>save_data.py</code></li><li><code>merge_data.py</code></li></ul><h3 id=post-processing-notebooks>Post-processing Notebooks</h3><p>We provide several starter notebooks to enable radar data processing and system characterization.</p><ul><li><code>notebooks/Field Processing.ipynb</code> A basic one stop radar processing code notebook, intended to produce ample information for in-field (or lab) debugging<ul><li>Loads a binary file containing IQ radar data and resaves it into <a href=https://zarr.readthedocs.io>Zarr</a> format</li><li>Loads the metadata associated with that binary file (YAML configuration file and log output)</li><li>Generates a reference chirp (by calling <code>preprocessing/generate_chirp.py</code>) to use for pulse compression</li><li>Displays a single received pulse in the time domain</li><li>Removes errors (if necessary) from the collected radar data</li><li>Coherently averages (stacks) the data based on user-input stacking parameter</li><li>Pulse compresses the data</li><li>Displays a 1D radargram of the first and last pulse compressed pulse</li><li>Displays a 2D radargram of the entire dataset</li><li>Displays spectrogram (fast-time) of received data</li><li>Displays power spectrum of received data</li></ul></li><li><code>notebooks/Radar 1D File Compare.ipynb</code> A notebook to compare 1D pulse compressed radar data in different files<ul><li>Facilitates comparison between different radar configurations</li></ul></li><li><code>notebooks/Radar 1D Stacking.ipynb</code> A notebook to display a 1D radargram with different amounts of stacking<ul><li>Facilitates comparison of stacking benefits and a quick check on coherence of data</li></ul></li><li><code>notebooks/Radar Spectrogram.ipynb</code> A notebook to display a fast time and slow time spectrogram of radar data<ul><li>Facilitates debugging of RFI, frequency spurs, and other noise sources</li></ul></li><li><code>notebooks/Dask Noise Statistics.ipynb</code> A notebook to compute and display mean noise power and variance for radar data<ul><li>Facilitates analysis of coherence by computing the mean noise power and variance for different amounts of radar stacking</li></ul></li></ul><p>The <code>notebooks/orca_paper</code> subdirectory contains notebooks used to produce the figures in our IEEE paper:</p><blockquote><p>T. O. Teisberg, A. L. Broome and D. M. Schroeder, &ldquo;Open Radar Code Architecture (ORCA): A Platform for Software-Defined Coherent Chirped Radar Systems,&rdquo; in <em>IEEE Transactions on Geoscience and Remote Sensing</em>, vol. 62, pp. 1-11, 2024, Art no. 5109411, doi: 10.1109/TGRS.2024.3446368.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-5bdc3eb38338c1ba9cd8687c226ed4de>1.2.1 - File Formats</h1><div class=lead>How data is stored from the ORCA system</div></div><div class=td-content style=page-break-before:always><h1 id=pg-b02afc278dc1a8009849113c17d595fc>1.2.2 - Processing Functions</h1><div class=lead>Basic postprocessing functions for working with radar data</div></div><div class=td-content style=page-break-before:always><h1 id=pg-14a4f29f8818ee6f2f782bbfa8403f94>1.2.3 - Postprocessing Notebooks</h1><div class=lead>An overview of ready-to-go notebooks for processing your data</div></div><div class=td-content style=page-break-before:always><h1 id=pg-aa8065218e85e6f199f149efce5cd0aa>1.2.4 - Timing and timestamping</h1><div class=lead>How recorded samples are timestamped and options for synchronization</div><div class="pageinfo pageinfo-primary"><p>Timestamping of received data is relatively basic and not yet suitable for
high-precision applications. This page describes the basics as currently implemented.</p><p>There is significant room to improve on ORCA here. USRP devices are capable of
multiple means of synchronization between devices that could be used to provide
better timestamping.</p></div><h2 id=relative-timing-of-samples>Relative timing of samples</h2><p>Transmit and receive events are scheduled as
<a href=https://kb.ettus.com/Synchronizing_USRP_Events_Using_Timed_Commands_in_UHD>timed commands</a>.
Generally, bursts of samples are recorded at intervals specified by <code>pulse_rep_int</code>.</p><p>When an error occurs, extra time is added to allow the system to catch up. The
amount of time added is configured by the <code>error_recovery_time</code> parameter. When
time is added, a message is printed to <code>stdout</code> with the chirp number and the
amount of time added, such as the following:</p><pre tabindex=0><code>[1691434273.020] 	[TX] (Chirp 975541) time_offset increased by 0.0016
</code></pre><p>Note that due to the enqueueing of commands, multiple errors may occur before the
next set of commands is enqueued with a time offset. If more than one error occurs,
the time will be offset by <code>number of errors * error_recovery_time</code>.</p><p>These output messages are read during the Zarr file creation process in order to
provide a corrected slow time record.</p><div class="alert alert-info" role=alert><h4 class=alert-heading>Older versions</h4>Older versions of ORCA did not print out the time offset messages and had hard-coded
error recovery time. When this situation is detected (by the combination of a
non-zero number of logged errors but no time offset messages), the time offset is
estimated based on the starting and ending system clock, rounded to the nearest
multiple of <code>pulse_rep_int</code>.</div><h2 id=timestamping-samples>Timestamping samples</h2><p>ORCA currently assumes that the SDR clock is useful to relative timing only and
relies on the <em>host computer</em> clock to provide a starting timestamp. When using
the <a href=https://orca.hisnr.com/docs/radar/sdr-interface/code/#runner-scripts>run.py interface</a>,
<code>stdout</code> output is logged with a Unix timestamp from the host computer. The
timestamp on the starting message (plus any specified <code>time_offset</code> in the config
file) is used to provide the absolute time of the first transmission.</p><p>This relies upon the system clock being set accurately and should never be assumed
to provide sub-second accuracy.</p><h2 id=accessing-timestamps-in-xarray>Accessing timestamps in Xarray</h2><p>The default coordiantes of the radar DataArray are <code>sample_idx</code> and <code>pulse_idx</code>.
These correspond to the fast time and slow time indices of the as-recorded data.</p><p>Considering <code>pulse_idx</code> this means, for example, that if <code>num_presums</code> is 10,
then there are 10 chirps transmitted and received for each index of <code>pulse_idx</code>.
Similarly, any errors are ignored in counting <code>pulse_idx</code>.</p><p>The additional data variables <code>chirp_sequence_idx</code>, <code>slow_time</code>, and <code>timestamp</code>
may be used if other information is needed. They are as follows:</p><ul><li><code>chirp_sequence_idx</code> refers to the index as tracked by the SDR of the first chirp
included in the associated data recording. With no errors,
<code>chirp_sequence_idx = num_presums * pulse_idx</code>.</li><li><code>slow_time</code> refers to the relative time (in seconds) of the start of the first
chirp included in the assocaited data recording.</li><li><code>timestamp</code> is an <code>np.datetime64</code> series equal to <code>slow_time + start timestamp</code></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-795007577fe9f887f0c83937d03b3ee9>2 - Peregrine UAV-Borne Radar</h1><div class=lead>Details about the Peregrine UAS</div><div class="pageinfo pageinfo-primary"><p>Peregrine is an ice-penetrating radar-equipped small UAS designed to be low-cost and field portable.</p></div></div><div class=td-content><h1 id=pg-cf252ce1f79916435033b3619324bc8b>2.1 - Peregrine Payload</h1><div class=lead>Details about the Peregrine Radar Payload</div><div class="pageinfo pageinfo-primary"><p>Peregrine is an ice-penetrating radar-equipped small UAS designed to be low-cost and field portable.</p></div></div><div class=td-content><h1 id=pg-5c54d50aa1e0b71de4f09d9fc05813b2>2.1.1 - Peregrine Radar Payload Box Assembly</h1><div class=lead>Build instructions for the core of the radar payload</div><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:689px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/peregrine-payload-box/payload-box-cad_hu_f2545c49d90b6935.png width=679 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Major components of the Peregrine radar payload box</p></p></figcaption></figure><h2 id=bill-of-materials>Bill of Materials</h2><p>A complete bill of materials for the payload box is available in <a href="https://docs.google.com/spreadsheets/d/1dFItvJ4mGw7Axdo4Iq9m_65ks9YspEahcemvucNRllk/edit?usp=sharing">this Google Sheet</a>, embedded below.</p><p>Some parts are custom made. See the <a href=https://orca.hisnr.com/docs/peregrine/resources/custom-parts/>Custom Parts</a> page for suggestions on how to build these yourself or source them from reliable vendors. Design files for these parts are available in the <a href=https://github.com/thomasteisberg/peregrine_hardware>Peregrine Hardware repository</a>.</p><script type=text/javascript>function resizeIframe(e){e.height=e.contentWindow.document.body.scrollHeight+"px"}</script><iframe id=iframe-id src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?gid=0&amp;amp;single=true&amp;amp;widget=true&amp;amp;headers=false" width=100% name=iframe-name style=min-height:40vh onload=resizeIframe(this) referrerpolicy=no-referrer><p>Your browser can not display embedded frames. You can access the embedded page via the following link: <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?gid=0&amp;amp;single=true&amp;amp;widget=true&amp;amp;headers=false">https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?gid=0&amp;amp;single=true&amp;amp;widget=true&amp;amp;headers=false</a></p></iframe><h2 id=assembly-instructions>Assembly instructions</h2><h3 id=preparing-enclosure-halves>Preparing enclosure halves</h3><p>The payload box is a clamshell-style design with two interlocking halves. The
&ldquo;upper&rdquo; half contains the SDR. The &ldquo;lower&rdquo; half holds the Raspberry Pi.
Sandwiched between the two halves is the &ldquo;payload divider&rdquo; PCB, which houses
some sensors and provides for external connections.</p><p>Starting with the Pi Shell:</p><ol><li>Place 4x M2.5 heat inserts into the four mounting holes at the bottom of the box.</li><li>Place 2x M2.5 heat inserts into the two front panel mounting holes on the
front of the box.</li></ol><p>Continuing with the SDR Shell:</p><ol start=3><li>Place 4x M2.5 heat inserts into the four holes in the tabs sticking up, to
accept bolts from the outside to connect the two shells together.</li></ol><h3 id=copper-foil-wrapping>Copper foil wrapping</h3><div class="alert alert-info" role=alert><h4 class=alert-heading>Why is the box wrapped in copper tape?</h4><p>The SDR and the Pi communicate over a USB 3 interface. Unfortunately, USB 3 has
known RF interference issues. The copper foil wrapping helps to minimize the
impact of the noisy USB 3 connection on other devices. We have particularly
had problems with GPS receivers (such as the one connected to the Peregrine
autopilot) not being able to get a fix without this copper wrapping.</p><p>You can read more about the USB 3 interference issues <a href=https://www.usb.org/sites/default/files/327216.pdf>from this Intel
appnote</a>.</p></div><p>Print out the <a href=https://github.com/thomasteisberg/peregrine_hardware/blob/main/payload_enclosure/fabrication_files_pi4/cutout_templates.pdf>cutout templates</a>. The PDF contains cutout templates for the copper foil wrapping on the top and bottom of the
enclosure.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Double check the dimensions</h4>Use a ruler to measure the marked dimensions on the first page to make sure your
print is at the right scale.</div><p>Spread a layer of adhesive-backed copper out on a cutting-safe surface
(such as a sacrificial piece of wood) and use some masking tape to hold it down.
Tape the cutout template on top. Use an X-Acto knife (or similar) to cut:</p><ol><li>A small &ldquo;X&rdquo; across each of the external bolt holes (to allow a bolt to go
through &ndash; no need to try to cut out the circle itself)</li><li>The internal cutout for the heatsink</li><li>The exterior outline of the entire piece.</li></ol><p>If you&rsquo;re not sure which lines to cut, take a moment to see how the paper folds
around the 3D printed pieces. Your goal is to fully cover the exterior.</p><p>Carefully peel away the adhesive from part of the copper foil and start pasting
it onto the 3D printed piece. It&rsquo;s easier to do this bit by bit, rather than
pulling the entire backing off at once.</p><p>Repeat with the other half of the enclosure.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7d2801d0e482f63a6a7d9bbfb01e045d>2.1.2 - Raspberry Pi Setup</h1><p>In order to standardize between units, much of the Pi setup is automated or
semi-automated. This guide will walk you through the steps of setting up
your Pi the way we do. Along the way, there are also links for more information
on how to customize this setup. This is an area where you will almost certainly
need to customize some aspects of the setup.</p><h2 id=initial-setup-with-cloud-init>Initial setup with cloud-init</h2><p>Setup of the Raspberry Pi is semi-automated using <a href=https://cloudinit.readthedocs.io/en/latest/>cloud-init</a>.</p><h3 id=cloud-init-customization>Cloud-init customization</h3><p>The cloud-init setup is controlled by two files: <code>user-data</code> and <code>network-config</code>.
(You&rsquo;ll use these files a couple of steps down.)</p><p>Examples of each are shown below, but you will likely need to modify these to suit
your purpose. We have pages on how to customize
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/user-data-config/>user-data</a> and
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>network-config</a>.</p><h4 id=user-data-example>user-data Example</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#cloud-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># This is the user-data configuration file for cloud-init.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># The cloud-init documentation has more details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>system_info</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>default_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Allow the default user to shutdown or reboot the system without entering a password (used by our automated scripts)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sudo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># On first boot, set the (default) ubuntu user&#39;s password to &#34;cryosphere&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>chpasswd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>expire</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$6$rounds=4096$aQ7tu0.beL3WAL32$fKxKYvZpY7EMCoxAU1heRomA3v8WvgbqBhhz08QwOtQdlP/DJOP2BThqZFoRW8d2a9PaIKK9BC9NHs1qNnkya1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hash</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Enable password authentication with the SSH daemon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ssh_pwauth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Set a default timezone</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>timezone</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Etc/UTC</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Update apt database and upgrade packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_update</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_upgrade</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Install additional packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>net-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>git</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>cmake</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>g++</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mosh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>exfat-fuse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2c-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>rpi.gpio-common</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>util-linux-extra</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Write arbitrary files to the file-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>write_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    exec &gt; &gt;(tee -a &#34;initial_setup_output.log&#34;) 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Miniconda Setup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    wget --progress=bar:force:noscroll &#34;https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh&#34; -O $HOME/miniconda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    bash $HOME/miniconda.sh -b -p $HOME/miniconda
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd $HOME
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source .profile
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source miniconda/etc/profile.d/conda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda init bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Setup logger environment
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:thomasteisberg/uav_radar_logger.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Clone uhd_radar repo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:radioglaciology/uhd_radar.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd uhd_radar
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #git checkout thomas/dask # Uncomment if you want to check out a specific branch other than main
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda env create -n uhd -f environment-rpi.yaml
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda activate uhd
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    python /home/ubuntu/miniconda/envs/uhd/lib/uhd/utils/uhd_images_downloader.py
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable radar.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable logger.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ifconfig
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    sudo reboot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.profile</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    PATH=/home/ubuntu/miniconda/bin:$PATH
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source /home/ubuntu/.bashrc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.ssh/known_hosts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk=</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/security/limits.conf</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Recommended by Ettus https://kb.ettus.com/USRP_Host_Performance_Tuning_Tips_and_Tricks</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ubuntu    - rtprio    99</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/radar.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to run the radar code on startup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uhd_radar/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uhd_radar/manager/radar_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=10
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/logger.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to log data from I2C sensors and automatically shutdown below a voltage threshold
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uav_radar_logger/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uav_radar_logger/logger_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=60
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Run arbitrary commands at rc.local like time</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># These commands are run with root permissions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># If you want commands run as a normal user, put them in initial_setup.sh (see above)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># which is run as the &#34;ubuntu&#34; user (see below)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>runcmd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown -R ubuntu:ubuntu /home/ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chmod +x /home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>wget -O /etc/udev/rules.d/uhd-usrp.rules https://raw.githubusercontent.com/EttusResearch/uhd/master/host/utils/uhd-usrp.rules</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G i2c ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G dialout ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G tty ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>apt remove -y modemmanager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>systemctl stop serial-getty@ttyS0.service &amp;&amp; systemctl disable serial-getty@ttyS0.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2cdetect -y 1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;dtoverlay=i2c-rtc,pcf8523&#34; &gt;&gt; /boot/firmware/config.txt</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>loginctl enable-linger ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mkdir /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chgrp ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;/dev/sda2  /media/ssd  exfat  defaults,nofail,uid=1000,gid=1000  0  2&#34; | tee -a /etc/fstab</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=network-config-example>network-config Example</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This file contains a netplan-compatible configuration which cloud-init will</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># apply on first-boot (note: it will *not* update the config after the first</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># boot). Please refer to the cloud-init documentation and the netplan reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># for full details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config-format-v2.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://netplan.io/reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ethernets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>eth0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Your ethernet name.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>192.168.11.137</span><span style=color:#000>/24]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>gateway4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>192.168.11.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nameservers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8.8.8.8</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>8.8.4.4</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>wifis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>renderer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>networkd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>wlan0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>optional</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>access-points</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI SSID HERE&gt;&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI PASSWORD HERE&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=imaging-your-pi>Imaging your Pi</h2><p>To start, download the Raspberry Pi Imager tool (or use your preferred software
for imaging SD cards). On Ubuntu, you can install it like this:</p><pre tabindex=0><code>sudo apt install rpi-imager
</code></pre><p>For other operating systems, see the <a href=https://www.raspberrypi.com/software/>website</a>.</p><div class="alert alert-info" role=alert><h4 class=alert-heading>Note on selecting a microSD card</h4><p>Not all (micro) SD cards are the same. Speed and reliability can both vary a lot.</p><p>Especially if you plan to store your data to your MicroSD card, you don&rsquo;t want to
mess around with this. Don&rsquo;t use an SD card that&rsquo;s off-brand, questionably sourced
(i.e. possibly counterfeit), or used.</p><p>We use Samsung Pro Plus series MicroSD cards. There are other storage options too.
See <a href=https://orca.hisnr.com/docs/peregrine/payload/data-storage/>Other Storage Options</a> for details.</p></div><p>Launch Imager. After clicking on &ldquo;Choose OS,&rdquo; navigate through the general purpose
category to find <code>Ubuntu Server 22.04.xx LTS 64-bit</code>. 64-bit is important &ndash; 32-bit
will not work.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:580px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-os_hu_a0ceabf4df131864.png width=570 height=115><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>You want Ubuntu Server 22.04 LTS 64-bit.</p></p></figcaption></figure><p>Insert your MicroSD card and select it as the location to write to.</p><p>After imaging is complete, you will see two drives mounted: <code>writable</code> and
<code>system-boot</code>.</p><h2 id=copying-cloud-init-config-files>Copying cloud-init config files</h2><p>After customizing the <code>user-data</code> and <code>network-config</code> files (see above),
copy <code>user-data</code> and <code>network-config</code> to the <code>system-boot</code> volume, replacing the
existing files.</p><p>Eject the microSD and put it back in the Pi.</p><h2 id=running-cloud-init>Running cloud-init</h2><div class="alert alert-info" role=alert><h4 class=alert-heading>Your Pi needs an internet connection for this part</h4>Make sure you Pi will have access to the internet before you begin this part.
See the <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>networking page</a> for information.</div><p>Power up the Pi and wait for cloud-init to run.</p><p>Within about a minute, your Pi should connect to whatever network interface(s)
are described in <code>network-config</code> and you should be able to find it on the
network. If you setup some sort of key-based authentication (such as by
importing a key from GitHub), it may take an extra couple of minutes for
this to be ready.</p><p>After the network setup is complete, you should be able to login over SSH.</p><p>For instructions on SSH-ing into your Pi, see <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/connect-to-pi/>here</a>.
In particular, please note that you need to have SSH agent forwarding working.
Instructions for this are on that page.</p><p>When you first login, cloud-init may not have finished running. To check the status, run:</p><pre tabindex=0><code>cloud-init status --long
</code></pre><p>There are also logs in <code>/var/log/cloud-init-output.log</code>.</p><p>To keep an eye on the entire process, you can run:</p><pre tabindex=0><code>watch &#34;cloud-init status --long &amp;&amp; tail -n 10 /var/log/cloud-init-output.log&#34;
</code></pre><p>Expect this process to take a few minutes to complete.</p><h2 id=running-initial_setupsh>Running initial_setup.sh</h2><p>After the cloud-init process is complete, you&rsquo;ll also need to run
<code>initial_setup.sh</code>:</p><p><code>./initial_setup.sh</code></p><p>This will log to <code>/home/ubuntu/initial_setup_output.log</code>. It may take around 10
minutes to complete. It will automatically reboot your Pi at the end. If you
don&rsquo;t want this, feel free to comment out the last line.</p><h2 id=setting-up-the-logger-service>Setting up the logger service</h2><p>More details on the logging service will eventually be <a href=https://orca.hisnr.com/docs/peregrine/operating/logger-service/>here</a>.</p><p>For now, if you&rsquo;re building a Peregrine system, the default setup should be fine.</p><p>If you&rsquo;re building Eyas, first run this command to create a place for logs:</p><pre tabindex=0><code>mkdir /media/ssd/logger
</code></pre><p>And then modify the last line of <code>/home/ubuntu/uav_radar_logger/logger_service.sh</code>
to look like this:</p><pre tabindex=0><code>python -u logger.py --shutdown-voltage 11.8 --log-dir /media/ssd/logger/
</code></pre><p>Replacing <code>11.8</code> with an appropriate threshold (in volts) at which to shutdown.</p><h2 id=setting-up-the-radar-service>Setting up the radar service</h2><p>More details on the radar service will eventually be <a href=https://orca.hisnr.com/docs/peregrine/operating/radar-service/>here</a>.</p><p>For now, if you&rsquo;re building a Peregrine system, the default setup should be fine.</p><p>If you&rsquo;re building Eyas, run these commands to create a location for logging data
and update the default configuration:</p><pre tabindex=0><code>mkdir /media/ssd/radar
cd /home/ubuntu/uhd_radar/config
mv default.yaml default-old.yaml
cp default-eyas.yaml default.yaml
</code></pre><h2 id=using-overlayroot-to-protect-the-file-system>Using overlayroot to protect the file system</h2><p>Let&rsquo;s take a quick step back and talk about the problem before we talk about
(perhaps drastic) solutions:</p><p><a href=https://hackaday.com/2022/03/09/raspberry-pi-and-the-story-of-sd-card-corruption/>MicroSD card corruption</a>
is an ongoing challenge for any device (such as the Pi) that boots from a
MicroSD card. Most cases can be traced to either (a) junk MicroSD cards or
(b) sudden power loss during a write operation.</p><p>You can mostly avoid problem (a) by carefully sourcing your MicroSD cards. If
you&rsquo;re considering saving $20 by buying an off-brand MicroSD card or, worse,
a possible fake, don&rsquo;t do it.</p><p>Sudden power loss is harder to completely guard against. Ideally, you want to
shutdown your Pi before removing power. This can be done by SSH-ing into it and
running <code>sudo shutdown -h now</code> and waiting about a minute. If you use our
radar systemd service, you can also perform a safe shutdown by pressing and
holding the button for 5 seconds, waiting for the light to turn off, and then
giving it about a minute to fully shut down.</p><p>For Peregrine, this should all be good enough.</p><p>For Eyas and other longer-term installations, the risk of a battery discharging
faster than expected is relatively high.</p><p>The first line of defense is the automatic shutdown provided by the logger
service that will safely shut everything down when the battery voltage gets too
low.</p><p>If you have a separate data storage device, such as an external USB-connected SSD,
you can go a step further and make your Pi&rsquo;s MicroSD card read-only.</p><p>A utility called <code>overlayroot</code> (which uses <a href=https://docs.kernel.org/filesystems/overlayfs.html>OverlayFS</a>)
can be used to make the root filesystem read-only and create an &ldquo;overlay filesystem&rdquo;
stored only in RAM. This means that all changes to the MicroSD card file system
are temporary and are lost upon reboot.</p><p>This is great for keeping a standardized configuration, but you need to be aware
that this means most log files are lost on reboot, any config files on the SD
card are lost on reboot, and all radar data you want to keep around must be stored
to your external storage device.</p><p>You can read
<a href=https://rex.writeas.com/use-overlay-filesystem-on-ubuntu>a more detailed tutorial about Overlayroot here</a>.</p><p><strong>If you&rsquo;re going to do this, be sure that you&rsquo;ve tested your setup in advance
so you know if the data you want to keep is being stored.</strong></p><h3 id=enabling-overlayroot>Enabling Overlayroot</h3><p>If you still want to set this up, it&rsquo;s quite easy to enable.</p><p>Simply edit the last line of <code>/etc/overlayroot.conf</code> to this:</p><pre tabindex=0><code>overlayroot=&#34;tmpfs:recurse=0&#34;
</code></pre><p><code>tmpfs</code> specifies that we want to use a RAM-based filesystem to store the &ldquo;overlay&rdquo;
part of the filesystem. <code>recurse=0</code> says that we want to apply this only to the
<code>/</code> mount and not to other mounts below that.</p><p>(You need to edit this file as root. For example: <code>sudo vim /etc/overlayroot.conf</code>)</p><h3 id=disabling-overlayroot>Disabling Overlayroot</h3><p>You can temporarily re-mount the root filesystem to edit things using the
built-in utility:</p><pre tabindex=0><code>sudo overlayroot-chroot
</code></pre><p>To exit, just type <code>exit</code>.</p><p>If you want to permenantly disable it, just edit the last line of <code>/etc/overlayroot.conf</code>
back to:</p><pre tabindex=0><code>overlayroot=&#34;&#34;
</code></pre><p>and reboot.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-261150229039da055a29b5b51b4e72e7>2.1.2.1 - Connecting to the Raspberry Pi</h1><p>By default, the cloud-init script sets up a static IP of <code>192.168.11.137</code>, but
you could choose to configure this to something different for each payload box.</p><p>Our usual way of connecting is by plugging an ethernet cable into the Pi and
connecting it to a laptop. You can read about
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>all the networking options here</a>.</p><h2 id=ssh-agent-forwarding>SSH agent forwarding</h2><p>If you need to authenticate to GitHub to download code, the recommended way is
using <a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/using-ssh-agent-forwarding>SSH agent forwarding</a>.</p><p>To summarize the above link, you should make sure you have
<a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/checking-for-existing-ssh-keys>an SSH key setup with your GitHub account</a>.</p><p>Test this by running <code>ssh -T git@github.com</code>.</p><p>Then modify your <code>~/.ssh/config</code> file to have an entry like this enabling
SSH agent forwarding:</p><pre tabindex=0><code>Host 192.168.11.137
    HostName 192.168.11.137
    User ubuntu
    ForwardAgent yes
</code></pre><h2 id=sshing-to-your-pi>SSH&rsquo;ing to your Pi</h2><p>Connect to the Raspberry Pi over SSH:</p><pre tabindex=0><code>ssh ubuntu@192.168.11.137
</code></pre><div class="alert alert-info" role=alert><h4 class=alert-heading>Remote host identification has changed</h4><p>If you use the same static IP for multiple Pi&rsquo;s (which, presumably, you only
ever use one of at a time), you may encounter an error stating:</p><pre tabindex=0><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
</code></pre><p>This is because your computer thinks its connecting to a different Raspberry Pi.</p><p>You can manually add the fingerprint for the currently connected Pi like this:</p><pre tabindex=0><code>ssh-keyscan -H 192.168.11.137 &gt;&gt; ~/.ssh/known_hosts
</code></pre><p>(This would be a bad idea to do at random for a remote computer. I&rsquo;m assuming
here that you&rsquo;ve just plugged in a new Pi right in front of you and you
know exactly why you&rsquo;re getting this error. You should only have to do this once
per new Pi.)</p></div><p>You can test that your SSH agent forwarding is working by running
<code>ssh -T git@github.com</code> again while SSH&rsquo;d into your Pi.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9e1cddaa6d9341ed8eb6a9978b03ad7e>2.1.2.2 - Debugging: Real-Time Clocks (RTC)</h1><div class=lead>RTC choices and possible solutions to RTC issues</div><p>A real-time clock (RTC) is a small device equipped with a crystal oscillator and
a battery that is responsible for keeping track of the current time, even while
your computer (or Raspberry Pi) is powered off.</p><p>The &ldquo;Payload Enclosure Divider&rdquo; includes a <a href=https://www.nxp.com/docs/en/data-sheet/PCF8523.pdf>PCF8523</a>
RTC and a holder for a CR1220 coin cell battery. The provided <code>user-config</code> file
should automatically set this up. As long as you provide internet access to
the Pi once, it will automatically synchronize the RTC with a network time server
and everything will just work.</p><h3 id=tell-me-more-about-the-pcf8523-and-how-to-use-it>Tell me more about the PCF8523 and how to use it</h3><p>Adafruit makes a great breakout for the same chip <a href=https://www.adafruit.com/product/5189>available here</a>.</p><p>They also have a great <a href="https://learn.adafruit.com/adding-a-real-time-clock-to-raspberry-pi?view=all">tutorial on setting up various RTCs with the Pi</a>.</p><h3 id=my-pi-5-already-has-an-rtc-built-in-right>My Pi 5 already has an RTC built-in, right?</h3><p>Yes, there is. <a href=https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#real-time-clock-rtc>Documentation for the built-in RTC is here.</a></p><p>The built-in RTC still requires adding a <em>rechargable</em> lithium manganese battery
to the Pi&rsquo;s J5 connector. Charging of this battery is disabled by default and
must be manually enabled.</p><p>In theory, you should be able to add the official Pi RTC battery, follow the
official instructions to enable charging, and everything should work.</p><h3 id=i-have-a-pi-5-but-still-want-to-use>I have a Pi 5 but still want to use</h3></div><div class=td-content style=page-break-before:always><h1 id=pg-cbee3f51f0dda6860ef7e3ca0ee7785a>2.1.2.3 - Customizing user-data</h1><p>The default user-data we start from is as shown below. You will likely need to
tweak many of these settings. Descriptions and tips for the most important
sections are below.</p><p>Note that this is one of two key configuration files. You can read about
<a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/>network-config here</a>.</p><h2 id=starting-point-user-data-file>Starting point user-data file</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#cloud-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># This is the user-data configuration file for cloud-init.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># The cloud-init documentation has more details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>system_info</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>default_user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Allow the default user to shutdown or reboot the system without entering a password (used by our automated scripts)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sudo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># On first boot, set the (default) ubuntu user&#39;s password to &#34;cryosphere&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>chpasswd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>expire</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$6$rounds=4096$aQ7tu0.beL3WAL32$fKxKYvZpY7EMCoxAU1heRomA3v8WvgbqBhhz08QwOtQdlP/DJOP2BThqZFoRW8d2a9PaIKK9BC9NHs1qNnkya1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hash</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Enable password authentication with the SSH daemon</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ssh_pwauth</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Set a default timezone</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>timezone</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Etc/UTC</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Update apt database and upgrade packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_update</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>package_upgrade</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Install additional packages on first boot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>net-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>git</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>cmake</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>g++</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mosh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>exfat-fuse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2c-tools</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>rpi.gpio-common</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>util-linux-extra</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## Write arbitrary files to the file-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>write_files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    exec &gt; &gt;(tee -a &#34;initial_setup_output.log&#34;) 2&gt;&amp;1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Miniconda Setup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    wget --progress=bar:force:noscroll &#34;https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh&#34; -O $HOME/miniconda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    bash $HOME/miniconda.sh -b -p $HOME/miniconda
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd $HOME
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source .profile
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source miniconda/etc/profile.d/conda.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda init bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Setup logger environment
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:thomasteisberg/uav_radar_logger.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    # Clone uhd_radar repo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    git clone git@github.com:radioglaciology/uhd_radar.git
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    cd uhd_radar
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    #git checkout thomas/dask # Uncomment if you want to check out a specific branch other than main
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda env create -n uhd -f environment-rpi.yaml
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    conda activate uhd
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    python /home/ubuntu/miniconda/envs/uhd/lib/uhd/utils/uhd_images_downloader.py
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable radar.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    systemctl --user enable logger.service
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ifconfig
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    sudo reboot</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.profile</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    PATH=/home/ubuntu/miniconda/bin:$PATH
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    source /home/ubuntu/.bashrc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/home/ubuntu/.ssh/known_hosts</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    github.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk=</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/security/limits.conf</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Recommended by Ettus https://kb.ettus.com/USRP_Host_Performance_Tuning_Tips_and_Tricks</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ubuntu    - rtprio    99</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>append</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/radar.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to run the radar code on startup
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uhd_radar/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uhd_radar/manager/radar_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=10
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/user/logger.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Unit]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Description=Service to log data from I2C sensors and automatically shutdown below a voltage threshold
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Service]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Type=simple
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WorkingDirectory=/home/ubuntu/uav_radar_logger/
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ExecStart=/home/ubuntu/uav_radar_logger/logger_service.sh
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    Restart=always
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    RestartSec=60
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    KillSignal=SIGINT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [Install]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    WantedBy=default.target</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Run arbitrary commands at rc.local like time</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># These commands are run with root permissions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># If you want commands run as a normal user, put them in initial_setup.sh (see above)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># which is run as the &#34;ubuntu&#34; user (see below)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>runcmd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown -R ubuntu:ubuntu /home/ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chmod +x /home/ubuntu/initial_setup.sh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>wget -O /etc/udev/rules.d/uhd-usrp.rules https://raw.githubusercontent.com/EttusResearch/uhd/master/host/utils/uhd-usrp.rules</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G i2c ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G dialout ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>usermod -a -G tty ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>apt remove -y modemmanager</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>systemctl stop serial-getty@ttyS0.service &amp;&amp; systemctl disable serial-getty@ttyS0.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>i2cdetect -y 1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;dtoverlay=i2c-rtc,pcf8523&#34; &gt;&gt; /boot/firmware/config.txt</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>loginctl enable-linger ubuntu</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>mkdir /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chown ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>chgrp ubuntu /media/ssd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>echo &#34;/dev/sda2  /media/ssd  exfat  defaults,nofail,uid=1000,gid=1000  0  2&#34; | tee -a /etc/fstab</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=password-less-shutdown>Password-less shutdown</h2><pre tabindex=0><code>system_info:
  default_user:
    name: ubuntu # Allow the default user to shutdown or reboot the system without entering a password (used by our automated scripts)
    sudo: &#34;ALL=(ALL) NOPASSWD: /sbin/poweroff, /sbin/reboot, /sbin/shutdown&#34;
</code></pre><p>One of the features supported by the uav_radar_logger utility is to automatically
cleanly shutdown the system if the measured battery voltage drops below a
threshold. To facilitate this, the default user must be able to shutdown the
system without needing additional authentication. This gives permission for the
<code>ubuntu</code> user to call <code>sudo shutdown</code> or <code>sudo reboot</code> without entering a password.</p><h2 id=password-authentication>Password authentication</h2><pre tabindex=0><code># On first boot, set the (default) ubuntu user&#39;s password to &#34;cryosphere&#34;
chpasswd:
  expire: false
  list:
  - ubuntu:$6$rounds=4096$aQ7tu0.beL3WAL32$fKxKYvZpY7EMCoxAU1heRomA3v8WvgbqBhhz08QwOtQdlP/DJOP2BThqZFoRW8d2a9PaIKK9BC9NHs1qNnkya1

# Enable password authentication with the SSH daemon
ssh_pwauth: true
</code></pre><p>This sets up a default password for the <code>ubuntu</code> user. You should change this to
something else (or disable password authentication completely, if you prefer).</p><p>Passwords are stored in a hashed format. You can generate password hashes using
this utility:</p><pre tabindex=0><code>mkpasswd --method=SHA-512 --rounds=4096
</code></pre><h2 id=timezone>Timezone</h2><pre tabindex=0><code># Set a default timezone
timezone: Etc/UTC
</code></pre><p>You could set this to other time zones (i.e. `America/Los_Angeles"), but really
it would make everyone&rsquo;s life easier if you just set your clock to UTC.</p><h2 id=add-ssh-keys-through-github>Add SSH keys through GitHub</h2><pre tabindex=0><code>## On first boot, use ssh-import-id to give the specific users SSH access to
## the default user
ssh_import_id:
- gh:thomasteisberg
- gh:albroome
- gh:dfxmay
</code></pre><p>You can very conveniently enable key-based authentication for specific GitHub
user names. If your username is in here and you have a public key setup with GitHub,
this public key will be imported and you will be able to SSH into your Pi
with no additional setup. You might want to remove us from your list, though. :)</p><h2 id=files>Files</h2><p>Arbitrary files can be written to the system with cloud-init. Some of these are
important.</p><h3 id=initial_setupsh>initial_setup.sh</h3><pre tabindex=0><code>- path: /home/ubuntu/initial_setup.sh
  content: |
    #!/bin/bash
    exec &gt; &gt;(tee -a &#34;initial_setup_output.log&#34;) 2&gt;&amp;1
    # Miniconda Setup
    wget --progress=bar:force:noscroll &#34;https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-aarch64.sh&#34; -O $HOME/miniconda.sh
    bash $HOME/miniconda.sh -b -p $HOME/miniconda
    cd $HOME
    source .profile
    source miniconda/etc/profile.d/conda.sh
    conda init bash
    # Setup logger environment
    git clone git@github.com:thomasteisberg/uav_radar_logger.git
    # Clone uhd_radar repo
    git clone git@github.com:radioglaciology/uhd_radar.git
    cd uhd_radar
    #git checkout thomas/dask # Uncomment if you want to check out a specific branch other than main
    conda env create -n uhd -f environment.yaml
    conda activate uhd
    python /home/ubuntu/miniconda/envs/uhd/lib/uhd/utils/uhd_images_downloader.py
    systemctl --user enable radar.service
    systemctl --user enable logger.service
    ifconfig
    sudo reboot
  append: true
</code></pre><p>The <code>initial_setup.sh</code> script grabs copies of our code and sets up the radar and
logging services. This script is intended to be manually run the first time you
SSH into the system. This enables you to use
<a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/using-ssh-agent-forwarding>SSH agent forwarding</a>
to provide any needed GitHub authentication to get the code.</p><p>This is also where you would customize the repositories to check out (if, for
example, you&rsquo;ve forked our code) and where you can pick a branch to automatically
checkout.</p><h3 id=radar-and-logger-services>Radar and Logger services</h3><pre tabindex=0><code>- path: /etc/systemd/user/radar.service
  content: |
    [Unit]
    Description=Service to run the radar code on startup

    [Service]
    Type=simple
    WorkingDirectory=/home/ubuntu/uhd_radar/
    ExecStart=/home/ubuntu/uhd_radar/manager/radar_service.sh

    Restart=always
    RestartSec=10

    KillSignal=SIGINT

    [Install]
    WantedBy=default.target
- path: /etc/systemd/user/logger.service
  content: |
    [Unit]
    Description=Service to log data from I2C sensors and automatically shutdown below a voltage threshold

    [Service]
    Type=simple
    WorkingDirectory=/home/ubuntu/uav_radar_logger/
    ExecStart=/home/ubuntu/uav_radar_logger/logger_service.sh

    Restart=always
    RestartSec=60

    KillSignal=SIGINT

    [Install]
    WantedBy=default.target
</code></pre><p>Two systemd services are used to manage everything. One run the radar code in
its default button-controlled setup. The other runs basic logging of I2C-connected
sensors and handles automatic low-battery shutdown.</p><h2 id=run-commands>Run commands</h2><pre tabindex=0><code>runcmd:
- chown -R ubuntu:ubuntu /home/ubuntu
- chmod +x /home/ubuntu/initial_setup.sh
- wget -O /etc/udev/rules.d/uhd-usrp.rules https://raw.githubusercontent.com/EttusResearch/uhd/master/host/utils/uhd-usrp.rules
- usermod -a -G i2c ubuntu
- usermod -a -G dialout ubuntu
- usermod -a -G tty ubuntu
- apt remove -y modemmanager
- systemctl stop serial-getty@ttyS0.service &amp;&amp; systemctl disable serial-getty@ttyS0.service
- i2cdetect -y 1
- echo &#34;dtoverlay=i2c-rtc,pcf8523&#34; &gt;&gt; /boot/firmware/config.txt
- loginctl enable-linger ubuntu
- mkdir /media/ssd
- echo &#34;/dev/sda2  /media/ssd  exfat  defaults,nofail,uid=1000,gid=1000  0  2&#34; | tee -a /etc/fstab
</code></pre><p>Some final setup is done by running arbitrary commands. These are run as the root
user.</p><p>One aspect of this you may wish to customize are the last two lines, which add
settings to automatically mount an ExFAT-formatted SSD plugged into the Pi. This
can be (optionally) used as a storage location for radar data.</p><h2 id=testing-changes>Testing changes</h2><p>You may want to test your changes before using them on your Pi. Options for doing
that are <a href=https://cloudinit.readthedocs.io/en/latest/howto/predeploy_testing.html>described here</a>.
Note that the <code>initial_setup.sh</code> script downloads miniconda for the <code>aarch64</code>
architecture, which probably won&rsquo;t work on your computer. If you want to test that
part, you&rsquo;ll need to change this.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-61db8ec95a554267e86e9456c1179522>2.1.2.4 - Raspberry Pi Network Connection</h1><p>Most of the time, the Pi doesn&rsquo;t need an internet connection. There are, however,
a couple of cases where you may want some sort of a network connection to the Pi.</p><p>These are:</p><ol><li>Downloading data from the Pi to a computer (requires a network connection but not internet)</li><li>Initial setup with cloud-init (requires internet)</li><li>Updating code by pulling from GitHub (requires internet)</li></ol><h2 id=setting-up-network-interfaces>Setting up network interfaces</h2><h3 id=with-cloud-init-first-time-setup>With cloud-init (first-time setup)</h3><p>The preferred way to setup network interfaces is by providing them in the
<code>network-config</code> file read by <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/>cloud-init when first setting up the Pi</a>.</p><p>An example is shown below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This file contains a netplan-compatible configuration which cloud-init will</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># apply on first-boot (note: it will *not* update the config after the first</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># boot). Please refer to the cloud-init documentation and the netplan reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># for full details:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>#</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://cloudinit.readthedocs.io/en/latest/topics/network-config-format-v2.html</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># https://netplan.io/reference</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ethernets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>eth0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Your ethernet name.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>192.168.11.137</span><span style=color:#000>/24]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>gateway4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>192.168.11.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nameservers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8.8.8.8</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>8.8.4.4</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>wifis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>renderer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>networkd</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>wlan0</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dhcp4</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>optional</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>access-points</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI SSID HERE&gt;&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;YOUR WIFI PASSWORD HERE&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>The above configuration sets up a static IP over the ethernet interface. It
also configures <code>192.168.11.1</code> as the default gateway. This allows for sharing
an internet connection from a computer over this interface if desired.</p><p>The configuration also provides an SSID and password for a WiFi network. In practice,
we configure this to the settings for a phone hotspot that can be used to get
internet when WiFi is not otherwise available. This is also a simpler setup for
getting the Pi on the internet when needed.</p><h3 id=reconfiguring-with-netplan>Reconfiguring with netplan</h3><p>By default, network interfaces are configured with netplan. See
<a href=https://netplan.readthedocs.io/en/stable/examples/>the netplan documentation</a>
for more details.</p><h2 id=configuring-your-computer>Configuring your computer</h2><p>If you&rsquo;re connecting to the Pi via a simple ethernet cable to your computer,
you&rsquo;ll want both configured with static IPs. The config file above will do this
on the Pi side. On your computer, you&rsquo;ll want to set a static IP of <code>192.168.11.1</code>
and a netmask of <code>255.255.255.0</code>. For example, your settings may look like this:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:578px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/pi-internet/network-settings_hu_3b4ce8326a53a20e.png width=568 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Example laptop configuration to connect to the Pi over an ethernet cable</p></p></figcaption></figure><h3 id=sharing-internet-from-your-computer>Sharing internet from your computer</h3><div class="alert alert-info" role=alert><h4 class=alert-heading>Do you need to do this?</h4><p>This process is a little annoying to setup. If you can easily connect your Pi
to a separate WiFi network with internet access, you probably don&rsquo;t need to do this.</p><p>If your WiFi network requires complicated configuration to join, requires a key
or password you don&rsquo;t want to leave around on the Pi, or only allows some devices
to join, this is an alternative approach that only requires a separate computer
(i.e. your laptop) to have internet access.</p></div><p>Sharing your computer&rsquo;s internet connection from one network interface to another
is a useful trick to get an internet connection for the Pi. This can be done
between any two network interfaces (i.e. from your WiFi connection to the Pi over
ethernet or from one WiFi card to a network created by a second WiFi card).</p><p>The Arch Linux wiki has useful instructions for configuring
<a href=https://wiki.archlinux.org/title/Internet_sharing>internet sharing on Linux</a>.</p><p>To briefly summarize them:</p><p>All of this setup will happen on your laptop (or whatever computer has an
internet connection).</p><ol><li>Enable IPv4 forwarding: <code>sudo sysctl net.ipv4.ip_forward=1</code></li><li>Setup NAT with iptables: (See note below if you have docker installed!)</li></ol><pre tabindex=0><code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
sudo iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i net0 -o wlan0 -j ACCEPT
</code></pre><p>Where <code>wlan0</code> should be replaced with the name of the network interface on
your computer which is currently connected to the internet, and <code>net0</code> should
be replaced with the name of the network interface on the same computer which is
connected to the Pi.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Note for Docker users</h4><p>If you have docker installed on your system, it
<a href=https://docs.docker.com/network/packet-filtering-firewalls/>changes your default firewall settings</a>
. As a result, you need to setup NAT slightly differently:</p><pre tabindex=0><code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
sudo iptables -I DOCKER-USER 1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo iptables -I DOCKER-USER 2 -i net0 -o wlan0 -j ACCEPT
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4c89c29d53af73eddf3d18c23c181774>2.1.3 - Data Storage Options</h1><div class=lead>Options for how to store your radar data as its being recorded</div><p>There are three tested options for how to store your radar data, with various tradeoffs:</p><ol><li>MicroSD card &ndash; This is the <em>default</em> option that is assumed in the documentation.</li><li>External USB SSD or Flash Drive</li><li>NVMe SSD connected over PCIe interface (Pi 5 only)</li></ol><h3 id=microsd-card>MicroSD card</h3><p>This is the easiest option since it&rsquo;s built-in to the Raspberry Pi and requires no additional space or equipment.</p><p>MicroSD card quality varies significantly and counterfits are an issue. For this reason, purchasing from a reputable vendor is highly recommended.</p><p>We use <a href=https://www.samsung.com/us/computing/memory-storage/memory-cards/pro-plus-adapter-microsdxc-512gb-mb-md512sa-am/>Samsung Pro Plus MicroSDXC cards</a>, usually in 512 GB capacity.</p><p>You can find lots of online benchmarks of various MicroSD cards, such as <a href=https://www.jeffgeerling.com/blog/2019/raspberry-pi-microsd-card-performance-comparison-2019>this one</a> and <a href=https://www.pidramble.com/wiki/benchmarks/microsd-cards>this one</a>.</p><p>There are two downsides to this approach:</p><ol><li>Above 1 TB, MicroSD cards start to get quite expensive.</li><li>If you&rsquo;re storing data on the MicroSD card, it&rsquo;s not possible to use <a href=https://orca.hisnr.com/docs/peregrine/payload/pi-sd-setup/#using-overlayroot-to-protect-the-file-system><code>overlayroot</code> to protect</a> the file system from corruption.</li></ol><h3 id=external-usb-drives>External USB drives</h3><p>External USB 3 SSDs or flash drives may be plugged into the USB 3.0 ports on the Pi and used as storage devices. We have used Samsung T7 Shield SSDs successfully in field deployments. The major advantage of this approach is that it is easy to swap out storage devices.</p><h3 id=nvme-ssd>NVMe SSD</h3><p>Starting with the Pi 5, a PCIe port is exposed allowing for NVMe devices including SSDs to be added. We have succesfully used the <a href="https://shop.pimoroni.com/products/nvme-base?variant=41219587178579">Pimoroni NVMe Base</a>.</p><p>This is the highest speed and most reliable storage option. The configuration we&rsquo;ve tested so far has kept the OS and radar code on the MicroSD card and used the SSD only for storage. It is, however, possible to <a href=https://www.jeffgeerling.com/blog/2023/nvme-ssd-boot-raspberry-pi-5>boot directly</a> from an NVMe SSD, though this configuration has not been tested with ORCA.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7dcd91265f5b85793c574a265a4f3e68>2.1.4 - External button</h1><p>An external lighted push button can be added to turn the radar on and off. A
connector for this is included on the Payload Divider PCB.</p><h2 id=button-choices>Button choices</h2><p>The intended button for the UAV version is <a href=https://www.digikey.com/en/products/detail/nkk-switches/HB15CKW01-5C-CB/1056598>HB15CKW01-5C-CB</a>.</p><p>Most other similar buttons can be used. For the ground-based version, we use <a href=https://www.digikey.com/en/products/detail/e-switch/ULV4F2BSS311/5299297>ULV4F2BSS311</a>.
Some of the photos on this page are taken with this button, which can be mounted externally.</p><h2 id=wiring-the-button>Wiring the button</h2><p>The button connector is a 5 position JST GH connector. The
<a href=https://www.digikey.com/en/products/detail/jst-sales-america-inc/GHR-05V-S/807817>connectors</a>
and
<a href=https://www.digikey.com/en/products/detail/jst-sales-america-inc/AGHGH28K102/10108415>pre-crimped wires</a>
are available separately or you can
<a href=https://www.amazon.com/Pre-Crimped-Connectors-Pixhawk2-Pixracer-Silicone/dp/B07PBHN7TM/>buy a kit</a>.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:783px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/button/button-wiring_hu_46d48fbc4d1e211f.png width=773 height=384><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Schematic section for the button connector. Right side shows recommended connections to the lighted button.</p></p></figcaption></figure><p>If you buy pre-crimped wires, you&rsquo;ll need to cut the connector on one side off.</p><p>For JST connectors, the small notch on the contact aligns with the bottom side of the connector.
On the bottom of the connector housing, there are a series of small plastic pins that will
raise up as you insert the contact. Once you get the contact fully inserted, this pin will fall back down
to lay flush.</p><p>To assemble the button:</p><ol><li>Cut pre-crimped JST wires to length</li><li>Following the image above, strip and solder the free end of each wire to the
specified terminals on the switch.</li><li>Place a piece of heatshrink over each terminal and shrink.</li><li>(Optional) Twist the wires gently and use small pieces of heat shrink to
keep them in a neat bundle.</li><li>Insert the contacts into the JST GH 5 position housing, following the diagram
above.</li><li>Mount the button and insert the connector into the plug on the payload divider PCB.</li></ol><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:645px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/button/button-components-eyas_hu_2680371be372f5dd.jpg width=635 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Components of the button assembly. Note that these pictures were taken with the
alternative version of the button designed to be mounted on the outside of a
Pelican case.</p></p></figcaption></figure><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:605px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/payload/button/button-soldering-eyas_hu_ed7da4a496ead522.jpg width=595 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Cables soldered to the terminals of the button</p></p></figcaption></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-5ff86ec97550a3558ce99a1679a497ab>2.2 - 5V Power Board and Power Harnesses</h1><div class=lead>Build instructions for 5V power system</div><h2 id=5v-power-harness>5V Power Harness</h2><p>All lengths are tip to tip (including any connectors)</p><h3 id=connector-side-1-female-m8-connector-mcmaster-part-8605n11>Connector side 1: Female M8 connector (McMaster Part #8605N11)</h3><p>M8 pinout:</p><ul><li>Brown wire: 5V</li><li>Blue wire: GND</li></ul><p>Cut brown wire ~0.5 cm shorter than blue</p><h3 id=connector-side-2-molex-micro-fit-30-3-pos-connector-molex-part-0436450300>Connector side 2: Molex Micro-Fit 3.0 3 Pos connector (Molex Part #0436450300)</h3><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:810px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/power/microfit5v_hu_e70bacdbf5eacf29.jpg width=800 height=363><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Molex Micro-Fit 3 Position (5V Power) pinout &ndash; note location of the line indicating pin 1</p></p></figcaption></figure><p>Molex Micro-Fit pinout:</p><ul><li>Pin 1: unused</li><li>Pin 2: GND (black)</li><li>Pin 3: 5V (red)</li></ul><p>Use 22 AWG female terminals</p><p>Pre-crimped wires are available. Molex part is 2147611201 (black) and 2147612201 (red)</p><p>Cut black ~0.5 cm shorter than red</p><h3 id=assembly-instructions>Assembly instructions</h3><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:589px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/power/payload-power-components_hu_29fa22808ef6c1d4.jpg width=579 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Components of 5V power harness</p></p></figcaption></figure><ol><li>Cut all wires as shown in the photo above</li><li>Solder M8 brown wire to red Micro-Fit</li><li>Solder M8 blue wire to black Micro-Fit</li><li>Heat shrink each individual connection</li><li>Place larger (glue lined, if available) heat shrink over both connections and extending onto the yellow sheath of the M8 cable</li><li>Insert female MicroFit terminals into 3 position connector</li></ol><p>Result should look like below:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:810px><img class=card-img-top src=https://orca.hisnr.com/docs/peregrine/power/5vpowerwithconnectors_hu_36d85b1aca95bc54.jpg width=800 height=294><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Completed 5V power harness (on left) connected to 5V power board</p></p></figcaption></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-c753e93257e93b91e94aba20cb857012>2.3 - Peregrine Radar Operating Instructions</h1><div class=lead>Details about the Peregrine UAS</div><div class="pageinfo pageinfo-primary"><p>Operating instructions for the Peregrine radar system</p></div></div><div class=td-content><h1 id=pg-2d67bd174f92eee89f4c4bcb39fc874c>2.3.1 - Logger Service Setup</h1><p>TODO</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4d3881fa475af65bab19cad623617626>2.3.2 - Radar Service Setup</h1><p>TODO</p><p><a href=https://github.com/mmaz/systemd-conda>Useful reference for conda environments with services</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-88cc421379ba8b45e0513dd66c9c1425>2.4 - UAV Setup</h1><div class=lead>Instructions for building and setting up the aircraft part</div><p>test test</p></div><div class=td-content><h1 id=pg-dc56973d26ddd1ffb1dd1113ee13801d>2.4.1 - UAV Power</h1><div class=lead>Battery and power systems for the UAV</div><p>The Peregrine system uses <a href=https://www.zohd.net/lionpack>ZOHD Lionpack 18650 4S1P</a> batteries. <a href=https://www.getfpv.com/zohd-lionpack-18650-4s1p-3500mah-14-8v-li-ion-battery.html>GetFPV</a> is a good source for them.</p><p>Either one or two battery packs may be used (in parallel if two) depending on the flight time required.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-09d1c2e6fa237eb543abf8a55cc772dc>2.5 - Other Resources</h1><div class=lead>Other resources and tips</div><div class="pageinfo pageinfo-primary"></div></div><div class=td-content><h1 id=pg-aca7e25603b179d2271831f189bef5f0>2.5.1 - Sourcing Custom Parts</h1><div class=lead>Suggestions for getting custom parts made</div><p>Many of the parts used to build Peregrine are custom designs. In some instances,
these may be things you can build yourself if you have the right tools
(3D printer, laser cutter, etc). In almost all cases, however, it is also
possible to use our provided design files to order parts from reliable vendors.
For each type of manufacturing, this page includes some notes about how we
produce parts or which external vendors we have worked with.</p><p>You can find design files for the hardware components of Peregrine in the
<a href=https://github.com/thomasteisberg/peregrine_hardware>Peregrine Hardware repository</a>.</p><h2 id=3d-printing>3D Printing</h2><p>All of our designs rely heavily on 3D printing. We use a
<a href=https://www.prusa3d.com/category/original-prusa-i3-mk3s/>Prusa MK3S+</a> and
<a href=https://www.prusa3d.com/product/prusament-asa-lipstick-red-850g/>Prusament ASA Lipstick Red</a>
filament.</p><p>All of our designs should be printable on any common FDM printer.</p><p>Outsourced 3D printing is expensive relative to the low costs of desktop 3D
printers, especially for parts (like ours) that generally don&rsquo;t need sub-mm
tolerances. That said, there many 3D printing services. I have had good
experiences with <a href=https://www.shapeways.com/>Shapeways</a>. If you have a vendor
produce your parts and you are intending to use them in a UAV, be sure to
specify that you don&rsquo;t want them to be printed solid. We usually print at about
20% infill density. Solid parts will weigh a lot more.</p><p>ASA is our plastic of choice because it forms parts that are relatively strong,
relatively light weight, work over an extended temperature range, and suffer
minimal UV degradation. The downside is that it is somewhat more difficult to
print with, as compared to PLA filament. We use an enclosure to provide a heated
build volume. Almost all prints are done with a brim (setting available in your
slicing software) to avoid warping.</p><p>PLA is great for prototyping but likely not a good choice for critical outdoor
applications. PLA can easily get hot enough to warp in direct sunlight and may
degrade under extended exposure to UV.</p><p>ABS or other similar materials should be fine.</p><p>Note that filament type, nozzle size, and slicing settings will all make a big
difference to the final weight of your parts.</p><h2 id=laser-cutting>Laser Cutting</h2><p>All laser cut parts are produced by <a href=https://sendcutsend.com/>SendCutSend</a>.
Ponoko, Xometry, and many other options also exist. If you want to match our
materials exactly, though, SendCutSend will be easiest.
If you have a laser cutter, you could also make them yourself.</p><h2 id=cnc-machining>CNC Machining</h2><p>We usually have CNC machined parts made through <a href=https://www.hubs.com/>HUBS</a>,
which distributes jobs to a network of machine shops. They are not the cheapest
option, but they provide a nice balance between cost, speed, and reliability.</p><h2 id=printed-circuit-boards-pcbs-and-pcb-assembly>Printed Circuit Boards (PCBs) and PCB Assembly</h2><p>You can send most of our design files to any PCB shop you like working with.</p><p>The one exception are the Peregrine under-wing antennas, which are larger
(about 56 cm by 11 cm) than the maximum dimensions allowed for standard orders
at many PCB manufacturers. Additionally, we usually get these printed on thinner
FR4 to reduce weight. These two factors make them very expensive at some board
shops. <a href=https://www.pcbway.com/>PCBWay</a> will produce 5 (un-assembled boards)
for less than $150 including shipping to the US.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-878df201f7f734521f1896561fb0eb90>3 - MAPPERR Multi-frequency Radar</h1><div class="pageinfo pageinfo-primary"><p>Guidelines for building MAPPERR: a towable, coherent, ground-based, ice-penetrating radar</p></div><p>At its core MAPPERR, the Multi-frequency Active-Passive Exploration Radar-Radiometer, is a software-defined radio (SDR)-based ice-peentrating radar that runs <a href=https://orca.hisnr.com/docs/radar/>Open Radar Code Architecture (ORCA)</a>. Operable as a snowmachine-towed radar, MAPPERR is one of the few coherent ground-based ice-penetrating radars that has sufficient flexibilty and low enough cost to be utilized by a wide swath of field-going glaciologists. These pages focus on outlining suggestions for building your own version of MAPPERR. For more information on the architecture of a multi-frequency joint radar-radiometer, we refer you to the following publications:</p><ul><li>add list/section on publications></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fe4e9ca99da5ce4362052e329f655d25>3.1 - MAPPERR Core Hardware</h1><h3 id=minimum-required-hardware>Minimum Required Hardware</h3><p>The core components of MAPPERR are an <a href=https://www.ettus.com/all-products/x310-kit/>Ettus X310</a> software-defined radio (SDR), an external host computer, and two antennas (one for transmitting and one for receiving). We use <a href=https://www.ahsystems.com/catalog/SAS-512-2.php>these</a> log-periodic dipole array antennas, as well as homemade resistively loaded dipoles, depending on our desired center frequency. For our host computer, we typically use a laptop running Ubuntu.</p><p>MAPPERR can be operated in a basic configuration by connecting the antennas as shown in the diagram below and utilizing the <a href=https://orca.hisnr.com/docs/radar/sdr-interface/config/><code>default_x310.yaml</code></a> configuration file with ORCA.</p><ul><li>ADD DIAGRAM</li></ul><h3 id=interfacing-with-the-x310>Interfacing with the X310</h3><p>The Ettus X310 can connect to a host computer via either 1 Gb or 10 Gb ethernet. When connected via 1 Gb ethernet, the maximum radar sample rate that does not produce significant communications errors between the host computer and SDR is 25 MHz. When using 10 Gb ethernet, sample rates of up to 100 MHz are possible. To achieve the maximum possible sample rate (200 MHz), dual 10 Gb ethernet connection is needed.</p><p>Communicating with the SDR over ethernet requires network settings on the host computer to be set appropriately. See this guide and this guide from Ettus for more information. A <a href=https://github.com/radioglaciology/uhd_radar/blob/main/x310_startup.sh>startup script</a> is available in ORCA that can be modified be each user. You can check that you are connected correctly to the X310 by pinging its IP address (typically 192.168.10.2 for a 1 Gb ethernet connection and 192.168.40.2 for a 10 Gb connection), or running <code>uhd_find_devices</code> and <code>uhd_usrp_probe</code> from a terminal.</p><h3 id=uhd-version>UHD Version</h3><p>Currently, ORCA has only been tested with an X310/MAPPERR when running and using UHD 3.15. In principle, upgrades to future UHD versions should be possible, however, we have previously run into <a href=https://lists.ettus.com/empathy/thread/LO46KABJ6H3KQLITF65JGQPHE6QB3JAO>some issues</a> when upgrading.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-39d90f0be7a22239646ae3e9305a7bb3>3.1.1 - Alternative MAPPERR Configurations</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-86efaba9588e5d291b8386249f3e783d>3.2 - MAPPERR Antennas</h1><p>Antennas are an important part of any radar system, and especially a multi-frequency system like MAPPERR. In a full multi-frequency active-passive configuration, we envision MAPPERR having active radar channels centered at 2, 22, 330, and 1000 MHz, along with passive radiometer channels at 300 and 1000 MHz. We use <a href=https://www.ahsystems.com/catalog/SAS-512-2.php>these</a> log-periodic dipole array antennas to cover the 300 MHz and above bands. To cover the 2 and 22 MHz channels, we utilize homemade resistively loaded dipoles, each tuned to our desired center frequency.</p><h3 id=resistively-loaded-dipole-construction>Resistively Loaded Dipole Construction</h3><p>Resistively loaded dipoles are built based on the Wu-King resistive loading method (<a href=https://ieeexplore.ieee.org/document/1138429/>Wu and King, 1965</a>). We use #14 <a href=https://www.davisrf.com/antenna-wire/flexweave.php>Flex-Weave^TM^ wire</a> from Davis RF to construct our dipoles. Resistors should be rated for the appropriate peak and average power.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4613f0315825d535c9026a48446963e0>3.3 - Towing MAPPERR</h1><div class=lead>Details about towing the MAPPERR system</div><h3 id=inner-tube-sled-design>Inner Tube Sled Design</h3><h3 id=crossbar-sled-design>Crossbar Sled Design</h3></div><div class=td-content style=page-break-before:always><h1 id=pg-9e890912a199497805ced8ceeb3b219b>4 - SORA Sled-Towed Radar</h1><div class=lead>Details about the ground-based reconfiguration of Peregrine</div><div class="pageinfo pageinfo-primary"><p>SORA (Sledbord ORCA Reconfigured from Airborne) is a ground-based enclosure for the Peregrine radar payload that
has space to host a larger power amplifier. It was initially designed to be a testing platform for payloads for
larger UAVs, but it can also be used as a standalone ground-based system.</p><p>It can be paired with any antennas, but the MAPPERR antennas make a great choice.</p><p>Previously known as &ldquo;Peregrine+&rdquo;</p></div><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:543px><img class=card-img-top src=https://orca.hisnr.com/docs/sora/sora_insides_bench_hu_6e941b4cc6210797.jpg width=533 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>SORA enclosure on the bench</p></p></figcaption></figure><h2 id=rf-frontend>RF Frontend</h2><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:721px><img class=card-img-top src=https://orca.hisnr.com/docs/sora/peregrine_plus_rf_frontend_hu_390c1d1975bb286e.png width=711 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>Block diagram of the RF components in the SORA RF frontend. Maximum power levels under three scenarios (nominal, worst-case, and an example expected bed return) are shown. The system is designed to be modular, so feel free to swap out as needed.</p></p></figcaption></figure><h2 id=bill-of-materials>Bill of Materials</h2><p>A complete bill of materials for SORA is in <a href="https://docs.google.com/spreadsheets/d/1dFItvJ4mGw7Axdo4Iq9m_65ks9YspEahcemvucNRllk/edit?usp=sharing">this Google Sheet</a>, embedded below. The first tab has the Peregine payload enclosure BOM. The SORA tab has the parts specific to this enclosure.</p><p>Some parts are custom made. See the <a href=https://orca.hisnr.com/docs/peregrine/resources/custom-parts/>Custom Parts</a> page for suggestions on how to build these yourself or source them from reliable vendors. Design files for these parts are available in the <a href=https://github.com/thomasteisberg/peregrine_hardware>Peregrine Hardware repository</a>.</p><script type=text/javascript>function resizeIframe(e){e.height=e.contentWindow.document.body.scrollHeight+"px"}</script><iframe id=iframe-id src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?widget=true&amp;amp;headers=false" width=100% name=iframe-name style=min-height:40vh onload=resizeIframe(this) referrerpolicy=no-referrer><p>Your browser can not display embedded frames. You can access the embedded page via the following link: <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?widget=true&amp;amp;headers=false">https://docs.google.com/spreadsheets/d/e/2PACX-1vSJbgsZBh6xJ8d5_O48yUdmh09coE1oZ8njQWZqQKYorwuMoUEFA6LCj9P5QiVQtoCGBCOOl3b1RTjY/pubhtml?widget=true&amp;amp;headers=false</a></p></iframe><h2 id=power-amplifier-power-mounting>Power amplifier power mounting</h2><p>The power supply for the power amplifier mounts under the power amplifier tray. It looks like this without the rest installed:</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:543px><img class=card-img-top src=https://orca.hisnr.com/docs/sora/sora_pa_power_mounting_hu_e10e305004e028f7.jpg width=533 height=400><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><p>The power supply for the power amplifier shown without the power amplifier tray covering it.</p></p></figcaption></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-fc18e26190a35ff069b2aecd8dd50f71>5 -</h1><blockquote><p>T. O. Teisberg, A. L. Broome and D. M. Schroeder, &ldquo;Open Radar Code Architecture (ORCA): A Platform for Software-Defined Coherent Chirped Radar Systems,&rdquo; in <em>IEEE Transactions on Geoscience and Remote Sensing</em>, vol. 62, pp. 1-11, 2024, Art no. 5109411, doi: 10.1109/TGRS.2024.3446368.</p></blockquote></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/radioglaciology/uhd_radar aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>Anna Broome and Thomas Teisberg</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><p class="td-footer__about mt-2"><a href=https://orca.hisnr.com/about/>Contributors, Citations, Contact Info, and Acknowledgements</a></p></div></div></div></footer></div><script src=https://orca.hisnr.com/js/main.min.55a5ebb52e389e6bb3eb51bb72a971bb4aa19da2885a57d87391e32159086995.js integrity="sha256-VaXrtS44nmuz61G7cqlxu0qhnaKIWlfYc5HjIVkIaZU=" crossorigin=anonymous></script><script defer src=https://orca.hisnr.com/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://orca.hisnr.com/js/tabpane-persist.js></script></body></html>